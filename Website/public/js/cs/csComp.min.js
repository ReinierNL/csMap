var csComp;!function(e){!function(e){var t=function(){function e(){}return e}();e.Feature=t}(e.GeoJson||(e.GeoJson={}));e.GeoJson}(csComp||(csComp={}));var csComp;!function(e){!function(e){function t(e){return!e}function i(e){for(var t=[],i=0;i<arguments.length-1;i++)t[i]=arguments[i+1];for(var r=t.length;r--;)e=e.replace(new RegExp("\\{"+r+"\\}","gm"),t[r]);return e}function r(e){return!isNaN(parseFloat(e))&&isFinite(e)}function a(e){return"true"===e||"false"===e}function o(e){return!1}e.isNullOrEmpty=t,e.format=i,e.isNumber=r,e.isBoolean=a,e.isBbcode=o}(e.StringExt||(e.StringExt={}));e.StringExt}(csComp||(csComp={}));var csComp;!function(e){!function(e){var t=function(){function e(e,t){this.topic=e,this.callback=t}return e}();e.MessageBusHandle=t;var i=function(){function e(){PNotify.prototype.options.styling="fontawesome"}return e.prototype.notify=function(e,t){{var i={title:e,text:t,icon:"fa fa-info",cornerclass:"ui-pnotify-sharp",addclass:"stack-bottomright",stack:{dir1:"up",dir2:"left",firstpos1:25,firstpos2:25}};new PNotify(i)}},e.prototype.notifyBottom=function(){{var e={dir1:"up",dir2:"right",spacing1:0,spacing2:0},t={title:"Over Here",text:"Check me out. I'm in a different stack.",addclass:"stack-bar-bottom",cornerclass:"",width:"70%",stack:e};new PNotify(t)}},e.prototype.notifyData=function(e){new PNotify(e)},e.prototype.publish=function(t,i,r){e.cache[t]&&e.cache[t].forEach(function(e){return e(i,r)})},e.prototype.subscribe=function(i,r){return e.cache[i]||(e.cache[i]=new Array),e.cache[i].push(r),new t(i,r)},e.prototype.unsubscribe=function(t){var i=t.topic,r=t.callback;e.cache[i]&&e.cache[i].forEach(function(t,a){return t==r?void e.cache[i].splice(a,1):void 0})},e.cache={},e}();e.MessageBusService=i;var r=function(){function e(){}return e.prototype.bind=function(e,t){this.myEvents=this.myEvents||{},this.myEvents[e]=this.myEvents[e]||[],this.myEvents[e].push(t)},e.prototype.unbind=function(e,t){this.myEvents=this.myEvents||{},e in this.myEvents!=!1&&this.myEvents[e].splice(this.myEvents[e].indexOf(t),1)},e.prototype.unbindEvent=function(e){this.myEvents=this.myEvents||{},this.myEvents[e]=[]},e.prototype.unbindAll=function(){this.myEvents=this.myEvents||{};for(var e in this.myEvents)this.myEvents[e]=!1},e.prototype.trigger=function(e){for(var t=[],i=0;i<arguments.length-1;i++)t[i]=arguments[i+1];if(this.myEvents=this.myEvents||{},e in this.myEvents!=!1)for(var r=0;r<this.myEvents[e].length;r++)this.myEvents[e][r].apply(this,Array.prototype.slice.call(arguments,1))},e.prototype.registerEvent=function(e){this[e]=function(t,i){return"function"==typeof t&&(i&&this.unbindEvent(e),this.bind(e,t)),this}},e.prototype.registerEvents=function(e){var t=this;e.forEach(function(e){t.registerEvent(e)})},e}();e.EventObj=r}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var csComp;!function(e){!function(e){!function(e){e[e.None=0]="None",e[e.Image=1]="Image",e[e.Point=2]="Point",e[e.Square=3]="Square",e[e.Rectangle=4]="Rectangle",e[e.Line=5]="Line",e[e.Circle=6]="Circle",e[e.Freehand=7]="Freehand",e[e.Polyline=8]="Polyline",e[e.Polygon=9]="Polygon",e[e.MultiPolygon=10]="MultiPolygon"}(e.DrawingModeType||(e.DrawingModeType={}));e.DrawingModeType;!function(e){e[e.none=0]="none",e[e.bar=1]="bar",e[e.text=2]="text"}(e.featureFilterType||(e.featureFilterType={}));e.featureFilterType}(e.GeoJson||(e.GeoJson={}));e.GeoJson}(csComp||(csComp={}));var Helpers;!function(e){!function(e){var t="csWeb.resize";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("resize",["$window",function(e){return{terminal:!1,restrict:"A",scope:{resizeX:"@",resizeY:"@"},link:function(t,i){t.onResizeFunction=function(){if(t.resizeX){var r=e.innerWidth;i.width(r-t.resizeX+"px")}if(t.resizeY){var a=e.innerHeight;i.height(a-t.resizeY+"px")}},t.onResizeFunction(),angular.element(e).bind("resize",function(){t.onResizeFunction(),t.$apply()})}}}])}(e.Resize||(e.Resize={}));e.Resize}(Helpers||(Helpers={}));var LegendList;!function(e){e.html='<div style="position: relative;">    <h4 class="leftpanel-header">Legenda</h4>        <div >        <div ng-repeat="(key, val) in vm.$layerService.featureTypes" class="legendItem">            <div class="legendIcon">                <img ng-src="{{legendImage(val)}}" class="legendImage"  />            </div><span class="legendText">                {{legendName(key,val)}}            </span>        </div>    </div></div>'}(LegendList||(LegendList={}));var LegendList;!function(e){var t="csWeb.legendList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("legendList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.LegendListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(LegendList||(LegendList={}));var LegendList;!function(e){var t=function(){function e(e,t,i){this.$scope=e,this.$layerService=t,this.$mapService=i,e.vm=this,e.numberOfItems=10,e.legendImage=function(e){return null!=e.style&&"point"!=e.style.drawingMode.toLowerCase()?"includes/images/polygon.png":null!=e.style&&null!=e.style.iconUri?e.style.iconUri:"includes/images/marker.png"},e.legendName=function(e,t){return null!=t.name?t.name:e}}return e.$inject=["$scope","layerService","mapService"],e}();e.LegendListCtrl=t}(LegendList||(LegendList={}));var FeatureList;!function(e){e.html='<div style="position: relative;">    <h4 class="leftpanel-header">Features</h4>    <div class="has-feedback" style="padding:10px 4px 4px 4px;">        <span style="direction: ltr; position: static; display: block;">            <input id="searchbox" data-ng-model="featureFilter.properties" type="text"                   placeholder="Filter" autocomplete="off" spellcheck="false"                   style="position: relative; vertical-align: top;" class="form-control tt-input">        </span>        <span id="searchicon" class="fa form-control-feedback fa-filter" style="padding-top: 10px;"></span>    </div>    <table class="table table-striped table-condensed">        <!--vm.$layerService.features-->        <tr dir-paginate="feature in vm.$layerService.project.features | filter:featureFilter | orderBy:\'properties.Name\' | itemsPerPage: numberOfItems "            data-ng-click="vm.$mapService.zoomTo(feature);vm.$layerService.selectFeature(feature);" style="cursor: pointer; height: 50px; vertical-align: central">            <!--<td>Icon</td>-->            <td>{{ feature.properties.Name }}</td>            <td>                <i class="fa fa-chevron-right pull-right"></i>            </td>        </tr>    </table>    <dir-pagination-controls style="position: absolute; bottom: -80px;" max-size="6" boundary-links="false" direction-links="false" template-url="bower_components/angular-utils-pagination/dirPagination.tpl.html"></dir-pagination-controls></div>'}(FeatureList||(FeatureList={}));var FeatureList;!function(e){var t="csWeb.featureList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("featureList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.FeatureListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(FeatureList||(FeatureList={}));var FeatureList;!function(e){var t=function(){function e(e,t,i){this.$scope=e,this.$layerService=t,this.$mapService=i,e.vm=this,e.numberOfItems=10}return e.$inject=["$scope","layerService","mapService"],e}();e.FeatureListCtrl=t}(FeatureList||(FeatureList={}));var FilterList;!function(e){e.html='<div>    <h4 class="leftpanel-header">Filters</h4>    <div ng-show="vm.$layerService.noFilters">Momenteel zijn er geen filters geselecteerd. Wil je zelf een filter toevoegen, dan kan dat. Klik op een icoon of gebied op de kaart, en klik op het filter icoontje (<span class="fa fa-filter"></span>) in het rechter menu. Dan wordt er een filter aangemaakt voor de bijbehorende eigenschap.</div>    <a ng-hide="vm.$layerService.noFilters" ng-click="vm.$layerService.resetFilters()"><span class="fa fa-refresh"></span> reset</a>    <div id="filterChart"></div></div>'}(FilterList||(FilterList={}));var FilterList;!function(e){var t="csWeb.filterList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("filterList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.FilterListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(FilterList||(FilterList={}));var FilterList;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$layerService=t,e.vm=this}return e.$inject=["$scope","layerService"],e}();e.FilterListCtrl=t}(FilterList||(FilterList={}));var csComp;!function(e){!function(e){!function(e){e[e.GeoJson=0]="GeoJson",e[e.Kml=1]="Kml"}(e.LayerType||(e.LayerType={}));e.LayerType}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var LayersDirective;!function(e){e.html='<div>    <h4 class="leftpanel-header">Kaartlagen</h4>    <div data-ng-repeat="group in vm.$layerService.project.groups" style="margin-left: 5px">        <div style="float: left; margin-left: -10px; margin-top: 5px" data-toggle="collapse" data-target="#layergroup_{{group.id}}"><i class="fa fa-chevron-down togglebutton toggle-arrow-down"></i><i class="fa fa-chevron-up togglebutton toggle-arrow-up"></i></div>        <div popover="{{(group.description) ? group.description : \'\'}}"             popover-placement="right"             popover-width="400"             popover-trigger="mouseenter"             class="group-title">{{group.title}}</div>        <div id="layergroup_{{group.id}}" class="collapse in">            <div popover="{{(layer.description) ? layer.description : \'\'}}"                 popover-placement="right"                 popover-trigger="mouseenter"                                  data-ng-repeat="layer in group.layers">                <!--bs-popover>-->                <div style="list-style-type: none; padding: 0;" data-ng-class="{indent: layer.isSublayer}">                    <!--<button type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="right" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." data-original-title="" title="">Right</button>-->                    <div ng-hide="group.oneLayerActive" class="checkbox checkbox-primary" style="margin-left: 20px">                        <input type="checkbox" id="cblayer{{layer.id}}" ng-model="layer.enabled" data-ng-click="vm.toggleLayer(layer);">                        <label for="cblayer{{layer.id}}">                            {{layer.title}}                        </label>                    </div>                    <div ng-show="group.oneLayerActive" class="radio radio-primary" style="margin-left: 20px">                        <input type="radio" ng-value="true" id="rblayer{{layer.id}}" ng-model="layer.enabled" data-ng-click="vm.toggleLayer(layer);">                        <label for="rblayer{{layer.id}}">                            {{layer.title}}                        </label>                    </div>                </div>            </div>        </div>    </div></div>'}(LayersDirective||(LayersDirective={}));var LayersDirective;!function(e){var t="csWeb.layersDirective";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("layersDirective",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.LayersDirectiveCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(LayersDirective||(LayersDirective={}));var LayersDirective;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$layerService=t,e.vm=this}return e.prototype.toggleLayer=function(e){e.enabled=!e.enabled,e.enabled?this.$layerService.addLayer(e):this.$layerService.removeLayer(e),"$apply"!=this.$scope.$root.$$phase&&"$digest"!=this.$scope.$root.$$phase&&this.$scope.$apply()},e.$inject=["$scope","layerService"],e}();e.LayersDirectiveCtrl=t}(LayersDirective||(LayersDirective={}));var csComp;!function(e){!function(t){var i=function(){function e(){}return e}();t.SolutionProject=i;var r=function(){function e(){}return e}();t.Solution=r;var a=function(){function e(){this.markers={}}return e}();t.Project=a;var o=function(){function e(){}return e}();t.PropertyInfo=o;var n=function(){function e(){}return e}();t.ProjectLayer=n;var s=function(){function e(){}return e}();t.GroupFilter=s;var l=function(){function e(){this.availableAspects=["strokeColor","fillColor","strokeWidth"],this.colorScales={"wit - root":["white","red"],"rood - wit":["red","white"],"groen - rood":["green","red"],"rood - groen":["red","green"],"wit - blauw":["white","blue"],"blauw - wit":["blue","white"],"wit - groen":["white","green"],"groen - wit":["green","white"],"wit - orangje":["white","orange"],"oranje - wit":["orange","white"]}}return e}();t.GroupStyle=l;var c=function(){function e(){}return e}();t.ProjectGroup=c;var p=function(){function t(e,t,i){this.$location=e,this.$messageBusService=t,this.$mapService=i,this.layerGroup=new L.LayerGroup,this.info=new L.Control,this.mb=t,this.map=i,this.accentColor="",this.title="",this.layerGroup=new L.LayerGroup,this.featureTypes={},this.metaInfoData={},this.map.map.addLayer(this.layerGroup),this.noStyles=!0}return t.prototype.addLayer=function(e){var t=this,i=[];switch(e.type){case"GeoJson":async.series([function(t){e.group.oneLayerActive&&e.group.layers.forEach(function(t){t!=e&&t.enabled&&i.push(t)}),t(null,null)},function(i){e.styleurl?d3.json(e.styleurl,function(r,a){if(r)t.$messageBusService.notify("ERROR loading"+e.title,r);else if(a.poiTypes)for(var o in a.poiTypes){var n=a.poiTypes[o];o=e.id+"_"+o,t.featureTypes[o]=n}i(null,null)}):i(null,null)},function(i){d3.json(e.url,function(r,a){if(r)t.$messageBusService.notify("ERROR loading"+e.title,r);else{for(var o in a.poiTypes){var n=a.poiTypes[o];o=e.id+"_"+o,t.featureTypes[o]=n;var s=(n.style.iconUri,'{".style'+o+'":');null!=n.style.iconUri&&(s+=' { "background": "url('+n.style.iconUri+') no-repeat right center",'),s+=' "background-size": "100% 100%","border-style": "none"} }';var l=$.parseJSON(s);$.injectCSS(l)}if(e.group.clustering){var c=L.geoJson(a,{pointToLayer:function(i,r){return t.addFeature(i,r,e)},onEachFeature:function(i,r){e.group.markers[i.id]=r,r.on({mouseover:function(i){return t.showFeatureTooltip(i,e.group)},mouseout:function(e){return t.hideFeatureTooltip(e)}})}});e.group.cluster.addLayer(c)}else{e.mapLayer=new L.LayerGroup,t.map.map.addLayer(e.mapLayer);var p=L.geoJson(a,{onEachFeature:function(i,r){e.group.markers[i.id]=r,r.on({mouseover:function(i){return t.showFeatureTooltip(i,e.group)},mouseout:function(e){return t.hideFeatureTooltip(e)},mousemove:function(e){return t.updateFeatureTooltip(e)},click:function(){t.selectFeature(i)}})},style:function(i,r){return t.initFeature(i,e),e.group.markers[i.id]=r,t.style(i,e)},pointToLayer:function(i,r){return t.addFeature(i,r,e)}});t.project.features.forEach(function(i){if(i.layerId==e.id){var r=t.getFeatureType(i);i.properties.Name=i.properties[r.style.nameLabel]}}),e.mapLayer.addLayer(p)}}t.$messageBusService.publish("layer","activated",e),i(null,null),t.updateFilters()})},function(){i.forEach(function(e){t.removeLayer(e),e.enabled=!1})}])}},t.prototype.filterProperties=function(e){var t=[];return null!=e.filters&&e.filters.length>0&&e.filters.forEach(function(e){t.push(e.property)}),t},t.prototype.showFeatureTooltip=function(t,i){var r=t.target,a=r.feature,o="<span class='popup-title'>"+r.feature.properties.Name+" </span>";null!=i.filters&&i.filters.length>0&&i.filters.forEach(function(t){if(a.properties.hasOwnProperty(t.property)){var i=a.properties[t.property];null==t.meta||e.StringExt.isNullOrEmpty(t.meta.stringFormat)||(i=String.format(t.meta.stringFormat,parseFloat(i))),o+="<br><img src='includes/images/filter-black.png' style='width:12px; height:12px; margin-top:4px;float:left; margin-right:4px'/>"+t.title+":<b>"+i+"</b>"}}),null!=i.styles&&i.styles.length>0&&i.styles.forEach(function(e){if(null!=i.filters&&0==i.filters.filter(function(t){return t.property==e.property}).length&&a.properties.hasOwnProperty(e.property)){var t=a.properties[e.property];o+="<br><img src='includes/images/style-black.png' style='width:12px; height:12px; margin-top:4px;float:left; margin-right:4px'/>"+e.title+":<b>"+t+"</b>"}}),this.popup=L.popup({offset:new L.Point(0,-10),closeOnClick:!0,autoPan:!1}).setLatLng(t.latlng).setContent(o).openOn(this.map.map)},t.prototype.hideFeatureTooltip=function(){this.popup&&this.map.map&&(this.map.map.closePopup(this.popup),this.popup=null)},t.prototype.updateFeatureTooltip=function(e){null!=this.popup&&null!=e.latlng&&this.popup.setLatLng(e.latlng)},t.prototype.highlightFeature=function(e){var t={weight:7},i=e.target;i.bindPopup(i.feature.properties.Name).openPopup(),L.Browser.ie||i.bringToFront(),i.setStyle(t),L.Browser.ie||i.bringToFront()},t.prototype.resetHighlight=function(e){var t={weight:1},i=e.target;i.setStyle(t)},t.prototype.removeStyle=function(e){var t=e.group;t.styles=t.styles.filter(function(t){return t.id!=e.id}),this.updateGroupFeatures(t)},t.prototype.updateStyle=function(e){null!=e&&null!=e.group&&(e.info=this.calculatePropertyInfo(e.group,e.property),e.canSelectColor=e.visualAspect.toLowerCase().indexOf("color")>-1,this.updateGroupFeatures(e.group))},t.prototype.updateFeature=function(e,t){if("Point"==e.geometry.type){var i=this.findLayer(e.layerId);null!=i&&this.updateFeatureIcon(e,i)}else{if(null==t){var r=this.findLayer(e.layerId);t=r.group}if(null==t)return;var a=t.markers[e.id];this.updatePolygonStyle(a,e)}},t.prototype.updateGroupFeatures=function(e){var t=this;this.project.features.forEach(function(i){e.markers.hasOwnProperty(i.id)&&t.updateFeature(i,e)})},t.prototype.getDefaultMarkerStyle=function(){},t.prototype.updatePolygonStyle=function(e,t){var i=this.findLayer(t.layerId),r=this.style(t,i);e.setStyle(r)},t.prototype.getColor=function(e,t){if(e>t.info.sdMax)return t.colors[t.colors.length-1];if(e<t.info.sdMin)return t.colors[0];var i=chroma.interpolate.bezier(t.colors),r=i((e-t.info.sdMin)/(t.info.sdMax-t.info.sdMin)).hex();return r},t.prototype.style=function(e,t){var i=this,r={fillColor:"red",weight:2,opacity:1,color:"black",fillOpacity:.7},a=this.getFeatureType(e);return a.style&&(null!=a.style.fillColor&&(r.fillColor=a.style.fillColor),null!=a.style.strokeColor&&(r.strokeColor=a.style.strokeColor),null!=a.style.strokeWidth&&(r.weight=a.style.strokeWidth)),t.group.styles.forEach(function(t){if(t.enabled&&e.properties.hasOwnProperty(t.property)){var a=Number(e.properties[t.property]);switch(t.visualAspect){case"strokeColor":r.color=i.getColor(a,t);break;case"fillColor":r[t.visualAspect]=i.getColor(a,t);break;case"strokeWidth":r.weight=(a-t.info.sdMin)/(t.info.sdMax-t.info.sdMin)*10+1}}}),e.isSelected&&(r.weight=7,r.color="blue"),r},t.prototype.initFeature=function(e,t){return e.isInitialized=!0,null==e.id&&(e.id=this.getGuid()),e.layerId=t.id,this.project.features.push(e),t.group.ndx.add([e]),e.fType=this.getFeatureType(e),e.type},t.prototype.removeFeature=function(){},t.prototype.getPointIcon=function(e,t){var i;if(null!=e.htmlStyle)i=new L.DivIcon({className:"",iconSize:new L.Point(32,32),html:e.htmlStyle});else{var r="<div ",a={},o=this.getFeatureType(e);null==o.style.fillColor&&null==o.style.iconUri&&(o.style.fillColor="lightgray"),a.background=o.style.fillColor,a.width="32px",a.height="32px",a["border-radius"]="20%",a["border-style"]="solid",a["border-color"]="black",a["border-width"]="0",t.group.styles.forEach(function(t){if(t.enabled&&e.properties.hasOwnProperty(t.property)){var i=e.properties[t.property];switch(t.visualAspect){case"fillColor":var r=chroma.interpolate.bezier(t.colors);a["background-color"]=r((i-t.info.sdMin)/(t.info.sdMax-t.info.sdMin)).hex()}}}),e.isSelected&&(a["border-width"]="3px"),r+=" style='display: inline-block;vertical-align: middle;text-align: center;";for(var n in a)r+=n+":"+a[n]+";";r+="'>",null!=o.style.iconUri&&(r+="<img src="+o.style.iconUri+" style='width:"+(o.style.iconWidth-2)+"px;height:"+(o.style.iconHeight-2)+"px' />"),r+="</div>",i=new L.DivIcon({className:"",iconSize:new L.Point(o.style.iconWidth,o.style.iconHeight),html:r})}return i},t.prototype.updateFeatureIcon=function(e,t){var i=t.group.markers[e.id];null!=i&&i.setIcon(this.getPointIcon(e,t))},t.prototype.addFeature=function(e,t,i){{var r,a=this,o=this.initFeature(e,i);o.style}switch(e.geometry.type){case"Point":var n=this.getPointIcon(e,i);r=new L.Marker(t,{icon:n}),r.on("click",function(){a.selectFeature(e)});break;default:var s={fillColor:"Green"};r=L.multiPolygon(t,s)}return i.group.markers[e.id]=r,r},t.prototype.selectFeature=function(e){e.isSelected=!e.isSelected,this.updateFeature(e),null!=this.lastSelectedFeature&&this.lastSelectedFeature!=e&&(this.lastSelectedFeature.isSelected=!1,this.updateFeature(this.lastSelectedFeature)),this.lastSelectedFeature=e,e.isSelected?(this.$messageBusService.publish("sidebar","show"),this.$messageBusService.publish("feature","onFeatureSelect",e)):(this.$messageBusService.publish("sidebar","hide"),this.$messageBusService.publish("feature","onFeatureDeselect"))},t.prototype.findFilter=function(e,t){null==e.filters&&(e.filters=[]);var i=e.filters.filter(function(e){return e.property==t});return i.length>0?i[0]:null},t.prototype.findLayer=function(e){var t;return this.project.groups.forEach(function(i){i.layers.forEach(function(i){i.id==e&&(t=i)})}),t},t.prototype.setStyle=function(e){var t=this,i=e.feature;if(null!=i){this.noStyles=!1;var r=this.findLayer(i.layerId),a=new l;a.id=this.getGuid(),a.title=e.key,a.visualAspect="fillColor",a.canSelectColor=a.visualAspect.toLowerCase().indexOf("color")>-1,a.property=e.property,null==a.info&&(a.info=this.calculatePropertyInfo(r.group,e.property)),a.enabled=!0,a.group=r.group;var o=this.getFeatureType(i);return a.colors=o.style&&o.style.fillColor?["white","orange"]:["white","orange"],this.saveStyle(r.group,a),"point"==i.geometry.type.toLowerCase()?this.project.features.forEach(function(e){r.group.markers.hasOwnProperty(e.id)&&t.updateFeatureIcon(e,r)}):this.updateStyle(a),$('#leftPanelTab a[href="#styles"]').tab("show"),a}},t.prototype.saveStyle=function(e,t){var i=e.styles.filter(function(e){return e.visualAspect==t.visualAspect});if(i.length>0){var r=e.styles.indexOf(i[0]);e.styles.splice(r,1)}e.styles.push(t)},t.prototype.addFilter=function(e,t){var i=this.findFilter(e,t);if(null==i){var r=new s;r.property=t,r.title=t,r.rangex=[0,1],e.filters.push(r)}else{var a=e.filters.indexOf(i);-1!=a&&e.filters.slice(a,1)}this.updateFilters(),$('#leftPanelTab a[href="#filters"]').tab("show")},t.prototype.setFilter=function(e){var t=e.property,i=e.feature;if(null!=i){var r=this.findLayer(i.layerId);if(null!=r){var a=this.findFilter(r.group,t);if(null==a){var o=new s;if(o.property=t,o.meta=e.meta,o.filterType="bar",null!=o.meta)if(null!=o.meta.filterType)o.filterType=o.meta.filterType;else switch(o.meta.type){case"number":o.filterType="bar";break;default:o.filterType="text",o.stringValue=e.value,o.value=e.value}if(o.title=e.key,o.rangex=[0,1],"text"==o.filterType){var n=r.group.filters.filter(function(e){return"text"==e.filterType});n.forEach(function(e){e.dimension.filterAll(),e.dimension.dispose()}),r.group.filters=r.group.filters.filter(function(e){return"text"!=e.filterType})}r.group.filters.push(o)}else{var l=r.group.filters.indexOf(a);-1!=l&&r.group.filters.slice(l,1)}}this.updateFilters(),$('#leftPanelTab a[href="#filters"]').tab("show")}},t.prototype.getFeatureType=function(e){var t=e.properties.PoiTypeId||"Default",i=e.layerId+"_"+t;return i in this.featureTypes||(t in this.featureTypes?i=t:this.featureTypes[i]=this.createDefaultType(e)),e.featureTypeName=i,this.featureTypes[i]},t.prototype.createDefaultType=function(t){var i={};i.style={nameLabel:"Name"},i.metaInfoData=[];for(var r in t.properties){var a=[];a.label=r,a.title=r.replace("_"," "),a.isSearchable=!0,a.visibleInCallOut=!0,a.canEdit=!1;var o=t.properties[r];a.type=e.StringExt.isNumber(o)?"number":e.StringExt.isBoolean(o)?"boolean":e.StringExt.isBbcode(o)?"bbcode":"text",i.metaInfoData.push(a)}return i},t.prototype.resetFilters=function(){dc.filterAll(),dc.redrawAll()},t.prototype.getGroupFeatures=function(e){var t=[];e.layers.forEach(function(e){e.enabled&&t.push(e.id)});var i=this.project.features.filter(function(e){return t.indexOf(e.layerId)>-1});return i},t.prototype.rebuildFilters=function(e){e.ndx=crossfilter([]);var t=this.getGroupFeatures(e);e.ndx.add(t),this.updateFilters()},t.prototype.removeLayer=function(e){this.$messageBusService.publish("layer","deactivate",e);var t,i=e.group;null!=this.lastSelectedFeature&&this.lastSelectedFeature.layerId==e.id&&(this.lastSelectedFeature=null,this.$messageBusService.publish("sidebar","hide"),this.$messageBusService.publish("feature","onFeatureDeselect")),i.clustering?(t=i.cluster,this.project.features.forEach(function(i){if(i.layerId==e.id)try{t.removeLayer(e.group.markers[i.id]),delete e.group.markers[i.id]}catch(r){}})):this.map.map.removeLayer(e.mapLayer),this.project.features=this.project.features.filter(function(t){return t.layerId!=e.id});var r=e.id+"_";for(var a in this.featureTypes)0===a.lastIndexOf(r,0)&&delete this.featureTypes[a];0==i.layers.filter(function(e){return e.enabled}).length&&(i.filters.forEach(function(e){null!=e.dimension&&e.dimension.dispose()}),i.filters=[],i.styles=[]),this.rebuildFilters(i)},t.prototype.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},t.prototype.getGuid=function(){var e=(this.S4()+this.S4()+"-"+this.S4()+"-4"+this.S4().substr(0,3)+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()).toLowerCase();return e},t.prototype.openSolution=function(e,t){var i=this;$.getJSON(e,function(e){e.maxBounds&&(i.maxBounds=e.maxBounds,i.$mapService.map.setMaxBounds(new L.LatLngBounds(e.maxBounds.southWest,e.maxBounds.northEast))),e.viewBounds&&i.$mapService.map.fitBounds(new L.LatLngBounds(e.viewBounds.southWest,e.viewBounds.northEast)),e.baselayers.forEach(function(e){var t={};t.subtitle=e.subtitle,t.preview=e.preview,null!=e.subdomains&&(t.subdomains=e.subdomains),null!=e.maxZoom&&(t.maxZoom=e.maxZoom),null!=e.minZoom&&(t.minZoom=e.minZoom),null!=e.attribution&&(t.attribution=e.attribution),null!=e.id&&(t.id=e.id);var r=L.tileLayer(e.url,t);i.$mapService.baseLayers[e.title]=r,e.isDefault&&i.$mapService.changeBaseLayer(r)}),e.projects.length>0&&i.openProject(e.projects[0].url,t)})},t.prototype.openProject=function(e,t){var i,r=this;i=[],t&&t.split(";").forEach(function(e){i.push(e.toLowerCase())}),this.layerGroup.clearLayers(),this.featureTypes={},$.getJSON(e,function(e){if(r.project=e,r.project.featureTypes)for(var t in r.project.featureTypes){var a=r.project.featureTypes[t];r.featureTypes[t]=a}if(r.project.metaInfoData)for(var o in r.project.metaInfoData){var n=r.project.metaInfoData[o];r.metaInfoData[o]=n}r.project.features=[],r.project.groups.forEach(function(t){null==t.id&&(t.id=r.getGuid()),t.ndx=crossfilter([]),null==t.styles&&(t.styles=[]),null==t.filters&&(t.filters=[]),t.markers={},t.clustering?(t.cluster=new L.MarkerClusterGroup({maxClusterRadius:t.maxClusterRadius||80,disableClusteringAtZoom:t.clusterLevel||0}),r.map.map.addLayer(t.cluster)):(t.vectors=new L.LayerGroup,r.map.map.addLayer(t.vectors)),t.layers.forEach(function(e){null==e.reference&&(e.reference=r.getGuid()),e.group=t,(e.enabled||i.indexOf(e.reference.toLowerCase())>=0)&&(e.enabled=!0,r.addLayer(e))}),t.styles.forEach(function(e){null!=e.id&&(e.id=r.getGuid())}),t.filters.forEach(function(e){null!=e.id&&(e.id=r.getGuid())}),e.startposition&&r.$mapService.zoomToLocation(new L.LatLng(e.startposition.latitude,e.startposition.longitude)),r.updateFilters()}),r.$messageBusService.publish("project","loaded")})},t.prototype.zoom=function(){},t.prototype.calculatePropertyInfo=function(e,t){var i=this,r=new o;r.count=0;var a=0,n=0;if(e.layers.forEach(function(e){e.enabled&&i.project.features.forEach(function(i){if(i.layerId==e.id&&i.properties.hasOwnProperty(t)){var o=i.properties[t],s=Number(o);0/0!=s&&(r.count+=1,a+=s,n+=s*s,(null==r.max||s>r.max)&&(r.max=s),(null==r.min||s<r.min)&&(r.min=s))}})}),r.mean=a/r.count,r.varience=n/r.count-r.mean*r.mean,r.sd=Math.sqrt(r.varience),r.sdMax=r.mean+3*r.sd,r.sdMin=r.mean-3*r.sd,r.min>r.sdMin&&(r.sdMin=r.min),r.max<r.sdMax&&(r.sdMax=r.max),0/0==r.sdMin&&(r.sdMin=r.min),0/0==r.sdMax&&(r.sdMax=r.max),this.metaInfoData.hasOwnProperty(t)){var s=this.metaInfoData[t];null!=s.maxValue&&(r.sdMax=s.maxValue),null!=s.minValue&&(r.sdMin=s.minValue)}return r},t.prototype.updateFilters=function(){var e=this,t=$("#filterChart");t.empty(),this.noFilters=!0,this.project.groups.forEach(function(t){null!=t.filters&&t.filters.length>0&&($("<div style='float:left;margin-left: -10px; margin-top: 5px' data-toggle='collapse' data-target='#filters_"+t.id+"'><i class='fa fa-chevron-down togglebutton toggle-arrow-down'></i><i class='fa fa-chevron-up togglebutton toggle-arrow-up'></i></div><div class='group-title' >"+t.title+"</div><div id='filtergroupcount_"+t.id+"'  class='filter-group-count' /><div class='collapse in' id='filters_"+t.id+"'></div>").appendTo("#filterChart"),t.filters.forEach(function(i){switch(null!=i.dimension&&i.dimension.dispose(),e.noFilters=!1,i.filterType){case"text":e.addTextFilter(t,i);break;case"bar":e.addBarFilter(t,i)}})),e.updateFilterGroupCount(t)}),dc.renderAll()},t.prototype.updateTextFilter=function(e,t,i){null==i||""==i?t.filterAll():t.filterFunction(function(e){return null!=e?e.toLowerCase().indexOf(i.toLowerCase())>-1:!1}),e.filterResult=t.top(1/0),this.updateMapFilter(e),dc.renderAll()},t.prototype.updateFilterGroupCount=function(e){null!=e.filterResult&&$("#filtergroupcount_"+e.id).text(e.filterResult.length+" objecten geselecteerd")},t.prototype.addTextFilter=function(e,t){var i=this;t.id=this.getGuid();var r=("filter_"+t.id,e.ndx.dimension(function(e){return e.properties.hasOwnProperty(t.property)?e.properties[t.property]:null}));t.dimension=r,r.filterFunction(function(e){return null!=e?e.toLowerCase().indexOf(t.stringValue.toLowerCase())>-1:!1}),this.updateTextFilter(e,r,t.stringValue);var a="filtertext"+t.id;$("<h4>"+t.title+"</h4><input type='text' value='"+t.stringValue+"' class='filter-text' id='"+a+"'/><a class='btn' value="+t.value+" id='remove"+t.id+"'><i class='fa fa-times'></i></a>").appendTo("#filters_"+e.id),$("#"+a).keyup(function(){t.stringValue=$("#"+a).val(),i.updateTextFilter(e,r,t.stringValue),i.updateFilterGroupCount(e)}),$("#remove"+t.id).on("click",function(){var r=e.filters.indexOf(t);t.dimension.filterAll(),t.dimension.dispose(),t.dimension=null,-1!=r&&(e.filters=e.filters.slice(r-1,r)),dc.filterAll(),i.updateFilters(),i.resetMapFilter(e)
})},t.prototype.updateChartRange=function(e,t){var i=$("#fsfrom_"+t.id),r=$("#fsto_"+t.id),a=e.brush().extent();null!=a&&2==a.length?a[0]!=a[1]&&(console.log(a),i.val(a[0]),r.val(a[1])):(i.val("0"),r.val("1"))},t.prototype.addBarFilter=function(e,t){var i=this;t.id=this.getGuid();var r=this.calculatePropertyInfo(e,t.property),a="filter_"+t.id;$("<h4>"+t.title+"</h4><div id='"+a+"'></div><div style='display:none' id='fdrange_"+t.id+"'>from <span id='fsfrom_"+t.id+"'/> to <span id='fsto_"+t.id+"'/></div><a class='btn' id='remove"+t.id+"'>remove</a>").appendTo("#filterChart");var o=$("#fsfrom_"+t.id),n=$("#fsto_"+t.id),s=$("#fdrange_"+t.id);$("#remove"+t.id).on("click",function(){var r=e.filters.indexOf(t);-1!=r&&e.filters.splice(r,1),t.dimension.dispose(),i.updateFilters(),i.resetMapFilter(e)});var l=dc.barChart("#"+a),c=20,p=(r.sdMax-r.sdMin)/c,u=e.ndx.dimension(function(e){if(!e.properties.hasOwnProperty(t.property))return null;if(null!=e.properties[t.property]){var i=parseInt(e.properties[t.property]);return i>=r.sdMin&&i<=r.sdMax?Math.floor(i/p)*p:null}});t.dimension=u;{var d=u.group();l.width(275).height(90).dimension(u).group(d).transitionDuration(100).centerBar(!0).gap(5).elasticY(!0).x(d3.scale.linear().domain([r.sdMin,r.sdMax]).range([-1,c+1])).filterPrinter(function(e){var t="";if(e.length>0){var i=e[0];o.text(i[0].toFixed(2)),n.text(i[1].toFixed(2)),t+=i[0]}return t}).on("filtered",function(t){var r=t.hasFilter();r?s.show():s.hide(),dc.events.trigger(function(){e.filterResult=u.top(1/0),i.updateFilterGroupCount(e),i.updateMapFilter(e)})})}l.xUnits(function(){return 13}),o.on("change",function(){if($.isNumeric(o.val())){var e=parseInt(o.val()),t=l.filters();t.length>0&&(t[0][0]=e,l.filter(t[0]),l.render(),dc.redrawAll())}}),n.on("change",function(){if($.isNumeric(n.val())){var e=parseInt(n.val()),t=l.filters();t.length>0&&(t[0][1]=e,l.filter(t[0]),u.filter(t[0]),dc.renderAll())}}),l.yAxis().ticks(5),l.xAxis().ticks(5),this.updateChartRange(l,t)},t.prototype.updateMapFilter=function(e){$.each(e.markers,function(t,i){var r=e.filterResult.filter(function(e){return e.id==t}).length>0;if(e.clustering){var a=e.cluster.hasLayer(i);!r&&a&&e.cluster.removeLayer(i),r&&!a&&e.cluster.addLayer(i)}else{var o=e.vectors.hasLayer(i);!r&&o&&e.vectors.removeLayer(i),r&&!o&&e.vectors.addLayer(i)}})},t.prototype.resetMapFilter=function(e){$.each(e.markers,function(t,i){if(e.clustering){var r=e.cluster.hasLayer(i);r||e.cluster.addLayer(i)}else{var a=e.vectors.hasLayer(i);a||e.vectors.addLayer(i)}})},t.$inject=["$location","messageBusService","mapService"],t}();t.LayerService=p}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var BaseMapList;!function(e){e.html='<div>    <h4 class="leftpanel-header">Kaarten</h4>    <div data-ng-repeat="(key, value) in vm.$mapService.baseLayers" style="clear:left;">        <div ng-click="vm.selectBaseLayer(key);" class="select-basestyle">            <img data-ng-src="{{value.options.preview}}" class="preview-base-layer" style="margin-bottom:5px" />            <div style="margin:3px;float:left">                <span style="font-size: 18px;font-weight: bold;">{{key}}</span><br />                {{value.options.subtitle}}            </div>        </div>    </div></div>'}(BaseMapList||(BaseMapList={}));var BaseMapList;!function(e){var t="csWeb.baseMapList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("baseMapList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.BaseMapListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(BaseMapList||(BaseMapList={}));var BaseMapList;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$mapService=t,e.vm=this}return e.prototype.selectBaseLayer=function(e){var t=this.$mapService.baseLayers[e];this.$mapService.changeBaseLayer(t)},e.$inject=["$scope","mapService"],e}();e.BaseMapListCtrl=t}(BaseMapList||(BaseMapList={}));var csComp;!function(e){!function(e){var t=function(){function e(e,t,i){this.$scope=e,this.$location=t,this.$mapService=i,e.vm=this,this.$mapService.baseLayers={};var r=e.map=i.getMap();r.invalidateSize(),L.control.zoom({position:"bottomright"}).addTo(r),L.control.locate({position:"bottomright",drawCircle:!0,follow:!0,setView:!0,keepCurrentZoomLevel:!0,markerStyle:{weight:1,opacity:.8,fillOpacity:.8},circleStyle:{weight:1,clickable:!1},icon:"icon-direction",metric:!0,strings:{title:"My location",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:18,watch:!0,enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}}).addTo(r)}return e.$inject=["$scope","$location","mapService"],e}();e.MapCtrl=t}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var csComp;!function(e){!function(e){"use strict";var t=function(){function e(e){this.$messageBusService=e,this.baseLayers={},this.initMap()}return e.prototype.initMap=function(){this.map=L.map("map",{zoomControl:!1,attributionControl:!0})},e.prototype.changeBaseLayer=function(e){this.map.addLayer(e),this.activeBaseLayer&&this.map.removeLayer(this.activeBaseLayer),this.map.setZoom(this.map.getZoom()),this.map.fire("baselayerchange",{layer:e}),this.activeBaseLayer=e},e.prototype.invalidate=function(){this.map.invalidateSize()},e.prototype.zoomToLocation=function(e,t){this.map.setView(e,t||14)},e.prototype.zoomTo=function(e){var t,i=this;if("POINT"==e.geometry.type.toUpperCase())t=new L.LatLng(e.geometry.coordinates[1],e.geometry.coordinates[0]),this.map.setView(t,14);else{var r;e.geometry.type.toUpperCase().indexOf("MULTI")<0?r=this.getBoundingBox(e.geometry.coordinates[0]):(r=[1e3,-1e3,1e3,-1e3],e.geometry.coordinates.forEach(function(e){var t=i.getBoundingBox(e[0]);r=[Math.min(r[0],t[0]),Math.max(r[1],t[1]),Math.min(r[2],t[2]),Math.max(r[3],t[3])]}));var a=.05,o=L.latLng(Math.min(r[2],r[3]),Math.min(r[0],r[1])-a),n=L.latLng(Math.max(r[2],r[3]),Math.max(r[0],r[1])+a);this.map.fitBounds(new L.LatLngBounds(o,n))}this.$messageBusService.publish("sidebar","show"),this.$messageBusService.publish("feature","onFeatureSelect",e)},e.prototype.getBoundingBox=function(e){return e.reduce(function(e,t){return[Math.min(e[0],t[0]),Math.max(e[1],t[0]),Math.min(e[2],t[1]),Math.max(e[3],t[1])]},[1e3,-1e3,1e3,-1e3])},e.prototype.getMap=function(){return this.map},e.$inject=["messageBusService"],e}();e.MapService=t}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var StyleList;!function(e){e.html='<div>    <h4 class="leftpanel-header">Stijlen</h4>    <div ng-show="vm.$layerService.noStyles">Momenteel zijn er geen stijlen geselecteerd. Wil je zelf een stijl toevoegen, dan kan dat. Overal waar het het stijl icoontje (<i class="fa fa-eye"></i>) staat kan je er op drukken en wordt er een stijl aangemaakt.</div>    <div data-ng-repeat="group in vm.$layerService.project.groups" style="margin-left: 5px">        <div ng-show="group.styles.length">            <div style="float:left;margin-left: -10px; margin-top: 5px" data-toggle="collapse" data-target="#stylegroup_{{group.id}}"><i class="fa fa-chevron-down togglebutton toggle-arrow-down"></i><i class="fa fa-chevron-up togglebutton toggle-arrow-up"></i></div>            <div class="group-title">{{group.title}}</div>            <div id="stylegroup_{{group.id}}" class="collapse in">                <div data-ng-repeat="style in group.styles">                    <div class="checkbox checkbox-primary" style="margin-left:20px;float:left">                        <input type="checkbox" id="cbstyle{{style.id}}" ng-model="style.enabled" data-ng-change="vm.$layerService.updateStyle(style);">                        <label class="style-title" for="cbstyle{{style.id}}" style="width:175px">{{style.title}}</label>                    </div>                    <div style="float:right;margin-top:10px; width: 50px">                        <div data-ng-show="style.canSelectColor" style="float:left">                            <div class="dropdown">                                <div class="style-settings" data-toggle="dropdown">                                    <style>                                                                             </style>                                    <!--<img src="includes/images/fillcolor.png" style="width: 32px; height:32px" />-->                                    <div id="colors" style="border-radius: 50%;width: 20px;height:20px;border-style:solid;border-color: black;border-width: 1px;background: linear-gradient(to right, {{style.colors[0]}} , {{style.colors[1]}})">                                                                        </div>                                    <b class="caret"></b>                                </div>                                <!--<a class="btn btn-primary btn-sm" ng-model="style.visualAspect"  style="padding-left: 10px" href="#"> {{ style.visualAspect }} </a>-->                                <ul class="dropdown-menu" role="menu">                                    <li ng-repeat="(key,val) in style.colorScales" style="margin:3px;cursor: pointer">                                        <span ng-click="$parent.style.colors = val;vm.$layerService.updateStyle($parent.style)"> {{key}} </span>                                    </li>                                </ul>                            </div>                        </div>                        <div style="float:right">                            <div class="dropdown">                                <div class="style-settings" data-toggle="dropdown">                                    <!--<img src="includes/images/fillcolor.png" style="width: 32px; height:32px" />-->                                    <div class="style-aspect style-{{style.visualAspect}}"></div><b class="caret"></b>                                </div>                                <!--<a class="btn btn-primary btn-sm" ng-model="style.visualAspect"  style="padding-left: 10px" href="#"> {{ style.visualAspect }} </a>-->                                <ul class="dropdown-menu" role="menu">                                    <li ng-repeat="title in style.availableAspects" style="margin:3px;cursor: pointer">                                        <i class="style-aspect style-{{title}}" style="float:left" /><span ng-click="$parent.style.visualAspect = title;vm.$layerService.updateStyle($parent.style)"><img class="fa fa-search" style="margin-right: 8px" /> {{title}} </span>                                    </li>                                    <li class="divider"></li>                                    <li style="margin:3px;cursor: pointer"><i class="fa fa-remove" style="margin-right: 8px" style=" float:left" /><span ng-click="vm.$layerService.removeStyle(style)">Verwijder</span></li>                                </ul>                            </div>                        </div>                    </div>                </div>                <!--<div style="right:5px; position:absolute; margin-top: -15px"><a href="#" id="stylepop{{style.id}}" rel="popover" popover-template="template.html"><img src="includes/images/settings.png" width="20px"></a></div>-->            </div>        </div>    </div></div>'}(StyleList||(StyleList={}));var StyleList;!function(e){var t="csWeb.styleList";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("styleList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var i=50,r=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-i-r)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.StyleListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(StyleList||(StyleList={}));var StyleList;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$layerService=t,e.vm=this}return e.$inject=["$scope","layerService"],e}();e.StyleListCtrl=t}(StyleList||(StyleList={}));var csComp;!function(e){!function(e){var t=function(){function e(e,t){this.$scope=e,this.$mapService=t,e.vm=this,e.location=new L.LatLng(0,0)}return e.prototype.doSearch=function(){if(0===this.$scope.location.lat&&0===this.$scope.location.lng)alert("Directive did not update the location property in parent controller.");else{var e=new L.LatLng(this.$scope.location.lat,this.$scope.location.lng);this.$mapService.zoomToLocation(e)}},e.$inject=["$scope","mapService"],e}();e.SearchFormCtrl=t}(e.Search||(e.Search={}));e.Search}(csComp||(csComp={}));var FeatureProps;!function(e){e.html='<div data-ng-cloak data-ng-show="showMenu" >    <h4 class="rightpanel-header">        &nbsp;&nbsp;{{callOut.title}}    </h4>        <div class="container-fluid rightpanel-tabs" style="position: relative">            <div class="row" style="overflow:hidden">            <!-- Nav tabs -->            <span id="leftArr" style="display:block;padding:10px;margin-top:5px;position:absolute;background-color:transparent;z-index:2">                <i class="glyphicon glyphicon-chevron-left"></i>            </span>            <span id="rightArr" style="display:block;padding:10px;margin-top:5px;position:absolute;background-color:transparent;z-index:2">                <i class="glyphicon glyphicon-chevron-right"></i>            </span>            <ul class="nav nav-tabs" id="featureTabs" style="margin-left:10px">                <li data-toggle="tab" data-ng-class="{active : $first}" data-ng-repeat="(sectionTitle, section) in callOut.sections" ng-if="section.hasProperties()">                    <a ng-href="#rp-{{$index}}" data-toggle="tab" data-ng-if="section.showSectionIcon()" ng-click="featureTabActivated(sectionTitle, section)"><i class="fa {{section.sectionIcon}}"></i></a>                    <a ng-href="#rp-{{$index}}" data-toggle="tab" data-ng-if="!section.showSectionIcon()" ng-click="featureTabActivated(sectionTitle, section)">{{sectionTitle}}</a>                </li>            </ul>        </div>    </div>    <div class="tab-content" style="top:50px; width:355px; overflow-y: auto; overflow-x: hidden" resize resize-y="150">        <div data-ng-if="!$last" class="tab-pane" data-ng-class="{active : $first}" id="rp-{{$index}}" data-ng-repeat="(sectionTitle, section) in callOut.sections">            <table class="table table-condensed">                <tr popover="{{(item.description) ? item.description : \'\'}}"                    popover-placement="left"                    popover-trigger="mouseenter"                    popover-append-to-body="true"                    data-ng-repeat="item in section.properties">                    <td><a class="fa fa-filter makeNarrow" data-ng-show="item.canFilter" data-ng-click="vm.$layerService.setFilter(item)"></a></td>                    <td><a class="fa fa-eye makeNarrow" data-ng-show="item.canStyle" data-ng-click="vm.$layerService.setStyle(item)"></a></td>                    <td>{{item.key}}</td>                    <td class="text-right" data-ng-bind-html="vm.toTrusted(item.value)"></td>                </tr>            </table>        </div>        <!-- Treat last tab (filter) differently -->        <div data-ng-if="$last" class="tab-pane" data-ng-class="{active : $first}" id="rp-{{$index}}" data-ng-repeat="(sectionTitle, section) in callOut.sections">            <!-- Add filter panel to the last rendered element -->            <div class="has-feedback" style="padding:0 4px 4px 4px;">                <span style="direction: ltr; position: static; display: block;">                    <input id="searchbox" data-ng-model="search.key" type="text"                            placeholder="Filter" autocomplete="off" spellcheck="false"                            style="position: relative; vertical-align: top;" class="form-control tt-input">                </span>                <span id="searchicon" class="fa form-control-feedback fa-filter"></span>            </div>            <!--<input style="padding:4px;" class=" form-control" data-ng-model="search" placeholder="...">-->            <table id="searchTextResults" class="table table-condensed">                <tr popover="{{(item.description) ? item.description : \'\'}}"                    popover-placement="left"                    popover-trigger="mouseenter"                    popover-append-to-body="true"                    data-ng-repeat="item in section.properties | filter:search">                    <td><a ng-class="fa fa-filter makeNarrow" data-ng-show="item.canFilter" data-ng-click="vm.$layerService.setFilter(item)"></a></td>                    <td><a class="fa fa-eye makeNarrow" data-ng-show="item.canStyle" data-ng-click="vm.$layerService.setStyle(item)"></a></td>                    <td>{{item.key}}</td>                    <td class="text-right" data-ng-bind-html="vm.toTrusted(item.value)"></td>                </tr>            </table>        </div>    </div></div>'}(FeatureProps||(FeatureProps={}));var FeatureProps;!function(e){var t="csWeb.featureprops";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("featureprops",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var i=t(e);return function(e){i(e)}},replace:!0,transclude:!0,controller:e.FeaturePropsCtrl}}])}(FeatureProps||(FeatureProps={}));var FeatureProps;!function(e){var t=csComp.StringExt,i=(function(){function e(e){this.position=e,this.closeButton=!0,this.autoPan=!0}return e}(),function(){function e(e,t,i,r,a,o,n,s,l){this.key=e,this.value=t,this.property=i,this.canFilter=r,this.canStyle=a,this.feature=o,this.isFilter=n,this.description=s,this.meta=l}return e}());e.CallOutProperty=i;var r=function(){function e(e){this.metaInfos={},this.properties=[],this.sectionIcon=e}return e.prototype.showSectionIcon=function(){return!t.isNullOrEmpty(this.sectionIcon)},e.prototype.addProperty=function(e,t,r,a,o,n,s,l,c){this.properties.push(l?new i(e,t,r,a,o,n,s,l,c):new i(e,t,r,a,o,n,s,null,c))},e.prototype.hasProperties=function(){return null!=this.properties&&this.properties.length>0},e}();e.CallOutSection=r;var a=function(){function e(e,i,a){var o=this;this.type=e,this.feature=i,this.metaInfoData=a,this.sections={},this.setTitle();var n,s=new r("fa-info"),l=new r("fa-filter");if(null!=e){var c=[];if(null!=e.metaInfoKeys){var p=e.metaInfoKeys.split(";");p.forEach(function(t){if(t in a)c.push(a[t]);else if(null!=e.metaInfoData){var i=$.grep(e.metaInfoData,function(e){return e.label===t});i.length>=1&&c.push(i)}})}else null!=e.metaInfoData&&(c=e.metaInfoData);c.forEach(function(e){var r=o.getOrCreateCallOutSection(e.section)||s;r.metaInfos[e.label]=e;var a=i.properties[e.label];if(t.isNullOrEmpty(a)||$.isNumeric(a)||(a=a.replace(/&amp;/g,"&")),!t.isNullOrEmpty(a)){switch(e.type){case"bbcode":t.isNullOrEmpty(e.stringFormat)||(a=String.format(e.stringFormat,a)),n=XBBCODE.process({text:a}).html;break;case"number":n=$.isNumeric(a)?t.isNullOrEmpty(e.stringFormat)?a.toString():String.format(e.stringFormat,parseFloat(a)):a;break;default:n=a}if(e.canEdit||!t.isNullOrEmpty(n)){var c="number"==e.type||"text"==e.type,p="number"==e.type;null!=e.filterType&&(c="none"!=e.filterType.toLowerCase());var u=!1;e.visibleInCallOut&&r.addProperty(e.title,n,e.label,c,p,i,u,e.description,e),l.addProperty(e.title,n,e.label,c,p,i,u,e.description)}}})}s.properties.length>0&&(this.sections["AAA Info"]=s),l.properties.length>0&&(this.sections["ZZZ Search"]=l)}return e.prototype.getOrCreateCallOutSection=function(e){return t.isNullOrEmpty(e)?null:e in this.sections?this.sections[e]:(this.sections[e]=new r,this.sections[e])},e.prototype.setTitle=function(){var e;e=null==this.type||null==this.type.style||t.isNullOrEmpty(this.type.style.nameLabel)?this.feature.properties.Name:this.feature.properties[this.type.style.nameLabel],t.isNullOrEmpty(e)||$.isNumeric(e)||(this.title=e.replace(/&amp;/g,"&"))},e}();e.CallOut=a;var o=function(){function e(e,t,i,r,a,o){var n=this;this.$scope=e,this.$location=t,this.$sce=i,this.$mapService=r,this.$layerService=a,this.$messageBusService=o,this.sidebarMessageReceived=function(e){switch(e){case"toggle":n.$scope.showMenu=!n.$scope.showMenu;break;case"show":n.$scope.showMenu=!0;break;case"hide":n.$scope.showMenu=!1}"$apply"!=n.$scope.$root.$$phase&&"$digest"!=n.$scope.$root.$$phase&&n.$scope.$apply()},this.featureMessageReceived=function(e,t){switch(e){case"onFeatureSelect":n.displayFeature(t),n.$scope.poi=t,n.$scope.autocollapse(!0)}"$apply"!=n.$scope.$root.$$phase&&"$digest"!=n.$scope.$root.$$phase&&n.$scope.$apply()},this.scope=e,e.vm=this,e.showMenu=!1,e.featureTabActivated=function(e,t){o.publish("FeatureTab","activated",{sectionTitle:e,section:t})},this.$messageBusService.subscribe("sidebar",this.sidebarMessageReceived),this.$messageBusService.subscribe("feature",this.featureMessageReceived);var s=function(){var e=0;return $("#featureTabs>li").each(function(){var t=$(this).outerWidth();e+=t}),e};e.autocollapse=function(e){"undefined"==typeof e&&(e=!1);var t=$("#featureTabs");t.outerWidth()<s()||parseFloat(t.css("margin-left"))<0?($("#leftArr").show(),$("#rightArr").show(),e&&t.animate({"margin-left":"20px"},"slow")):($("#leftArr").hide(),$("#rightArr").hide(),e&&t.animate({"margin-left":"0px"},"slow"))},e.autocollapse(!0),$("#leftArr").click(function(){console.log("leftArr");var t=$("#featureTabs"),i=parseFloat(t.css("margin-left")),r=20,a=40;r>i-a&&(a=i-r),t.animate({"margin-left":"-="+a+"px"},"slow",function(){$("#rightArr").show(),$("#leftArr").show(),e.autocollapse(!1)})}),$("#rightArr").click(function(){var t=$("#featureTabs"),i=s()-t.outerWidth()+30;t.animate({"margin-left":"-="+i+"px"},"slow",function(){$("#leftArr").show(),$("#rightArr").show(),e.autocollapse(!1)})})}return e.prototype.toTrusted=function(e){return this.$sce.trustAsHtml(e)},e.prototype.displayFeature=function(e){var t=this.$layerService.featureTypes[e.featureTypeName];this.$scope.callOut=new a(t,e,this.$layerService.metaInfoData),"$apply"!=this.$scope.$root.$$phase&&"$digest"!=this.$scope.$root.$$phase&&this.$scope.$apply()},e.$inject=["$scope","$location","$sce","mapService","layerService","messageBusService"],e}();e.FeaturePropsCtrl=o}(FeatureProps||(FeatureProps={}));var DataTable;!function(e){var t=csComp.StringExt,i=function(){function e(e,t,i,r){this.displayValue=e,this.originalValue=t,this.type=i,this.header=r}return e}();e.TableField=i;var r=function(){function e(e,t,i,r,a,o){this.$scope=e,this.$http=t,this.$sce=i,this.$layerService=r,this.$localStorageService=a,this.$messageBusService=o,this.mapLabel="map",this.numberOfItems=10,this.layerOptions=[],this.metaInfos=[],this.headers=[],this.rows=[],e.vm=this,this.bindToStorage("vm.numberOfItems",10),this.numberOfItems=a.get("vm.numberOfItems"),this.bindToStorage("vm.selectedLayerId",this.mapLabel),null!=this.$layerService.project&&null!=this.$layerService.project.groups&&(this.updateLayerOptions(),this.loadLayer())}return e.prototype.bindToStorage=function(e,t){null===this.$localStorageService.get(e)&&this.$localStorageService.set(e,t),this.$localStorageService.bind(this.$scope,e)},e.prototype.updateLayerOptions=function(){var e=this;this.layerOptions.push({group:"",id:this.mapLabel,title:"Kaartfeatures"}),null!=this.$layerService.project&&null!=this.$layerService.project.groups&&(this.$layerService.project.groups.forEach(function(t){t.layers.forEach(function(i){e.layerOptions.push({group:t.title,id:i.id,title:i.title})})}),this.selectedLayerId=this.$localStorageService.get("vm.selectedLayerId"))},e.prototype.loadLayer=function(){var e=this;if(!this.selectedLayerId||this.selectedLayerId===this.mapLabel)return this.loadMapLayers();var t=this.findLayerById(this.selectedLayerId);return null==t?this.loadMapLayers():void this.$http.get(t.url).success(function(t){e.dataset=t,null==t.poiTypes&&(t.poiTypes={}),t.features.forEach(function(i){i.featureTypeName=i.properties.PoiTypeId,i.featureTypeName in t.poiTypes||(t.poiTypes[i.featureTypeName]=e.$layerService.featureTypes[i.featureTypeName])}),e.updateMetaInfo(t)}).error(function(){e.$messageBusService.notify("ERROR opening "+t.title,"Could not get the data.")})},e.prototype.loadMapLayers=function(){var e=this;this.selectedLayerId=this.mapLabel;var t={type:"",features:[],poiTypes:{}};this.$layerService.project.groups.forEach(function(e){null!=e.filterResult&&e.filterResult.forEach(function(e){return t.features.push(e)})}),0===t.features.length&&(t.features=this.$layerService.project.features),t.features.forEach(function(i){i.featureTypeName in t.poiTypes||(t.poiTypes[i.featureTypeName]=e.$layerService.featureTypes[i.featureTypeName])}),this.dataset=t,this.updateMetaInfo(t)},e.prototype.updateMetaInfo=function(e){var t=this;this.metaInfos=[],this.headers=[],this.rows=[];var i=[],r=[];r.push({label:"Name",visibleInCallOut:!0,title:"Naam",type:"text",filterType:"text",isSearchable:!0});var a;for(var o in e.poiTypes){if(a=e.poiTypes[o],null!=a.metaInfoKeys){var n=a.metaInfoKeys.split(";");n.forEach(function(e){if(e in t.$layerService.metaInfoData)r.push(t.$layerService.metaInfoData[e]);else if(null!=a.metaInfoData){var i=$.grep(a.metaInfoData,function(t){return t.label===e});i.length>=1&&r.push(i)}})}else null!=a.metaInfoData&&a.metaInfoData.forEach(function(e){return r.push(e)});r.forEach(function(e){(e.visibleInCallOut||"Name"===e.label)&&i.indexOf(e.title)<0&&(i.push(e.title),t.metaInfos.push(e))})}for(var s=3,l=0;s>l;l++)this.headers.push(i[l]);this.rows=this.getRows()},e.prototype.toggleSelection=function(e){var t=this.headers.indexOf(e);t>-1?this.headers.splice(t,1):this.headers.push(e),this.rows=this.getRows()},e.prototype.findLayerById=function(e){for(var t=0;t<this.$layerService.project.groups.length;t++)for(var i=this.$layerService.project.groups[t],r=0;r<i.layers.length;r++){var a=i.layers[r];if(a.id==e)return a}return null},e.prototype.getRows=function(){var e=this,r=[this.headers.length];this.metaInfos.forEach(function(t){var i=e.headers.indexOf(t.title);i>=0&&(r[i]=t)});var a,o=[];return this.dataset.features.forEach(function(e){var n=[];r.forEach(function(r){var o=e.properties[r.label];switch(t.isNullOrEmpty(o)?o=" ":$.isNumeric(o)||(o=o.replace(/&amp;/g,"&")),r.type){case"bbcode":a=XBBCODE.process({text:o}).html;break;case"number":a=$.isNumeric(o)?t.isNullOrEmpty(r.stringFormat)?o.toString():String.format(r.stringFormat,parseFloat(o)):"??";break;default:a=o}n.push(new i(a,o,r.type,r.title))}),o.push(n)}),o},e.prototype.sortOrderClass=function(e,t){var i;return i=null!=t&&e==this.sortingColumn?"fa fa-sort-"+(t?"desc":"asc"):"fa fa-sort"},e.prototype.orderBy=function(e,t){this.sortingColumn=e,this.rows=this.rows.sort(function(i,r){var a;return a="number"==i[e].type?i[e].originalValue>r[e].originalValue:i[e].originalValue.toLowerCase()>r[e].originalValue.toLowerCase(),a==t?1:-1})},e.prototype.downloadCsv=function(){var e=[];e.push(this.headers.join(";"));for(var t=0;t<this.rows.length;t++)e.push(this.rows[t].map(function(e){return e.originalValue}).join(";"));var i=e.join("%0A"),r=document.createElement("a");r.href="data:text/csv;charset=utf-8,"+i,r.target="_blank";var a=this.mapLabel;if(this.selectedLayerId!==this.mapLabel){var o=this.findLayerById(this.selectedLayerId);o&&(a=o.title.replace(" ","_"))}r.download=a+".csv",document.body.appendChild(r),r.click()},e.prototype.toTrusted=function(e){return this.$sce.trustAsHtml(e)},e.$inject=["$scope","$http","$sce","layerService","localStorageService","messageBusService"],e}();e.DataTableCtrl=r}(DataTable||(DataTable={}));var DataTable;!function(e){e.html='<div>    <div style="width:100%; margin: 10px auto;">        <div style="float: left; width: 15%; margin: 0; padding: 1em">            <!-- Pull down of map layers -->            <select data-ng-model="vm.selectedLayerId"                    data-ng-change="vm.loadLayer()"                    data-ng-options="layer.id as layer.title group by layer.group for layer in vm.layerOptions"                    class="form-control tt-input"></select>            <!-- List of headers -->            <ul class="form-group" style="margin-top: 1em; margin-left: -2em; overflow-y: auto; overflow-x: hidden;"                resize resize-y="150">                <li ng-repeat="mi in vm.metaInfos" class="list-unstyled" style="white-space: nowrap; text-overflow: ellipsis">                    <label>                        <input type="checkbox" name="vm.selectedTitles[]" value="{{mi.title}}"                               data-ng-checked="vm.headers.indexOf(mi.title) > -1"                               data-ng-click="vm.toggleSelection(mi.title)">&nbsp;&nbsp;{{mi.title}}                    </label>                    <!--<div class="checkbox">                        <label>                            <input type="checkbox" name="vm.selectedTitles[]" value="{{mi.title}}"                                   data-ng-checked="vm.headers.indexOf(mi.title) > -1"                                   data-ng-click="vm.toggleSelection(mi.title)">&nbsp;&nbsp;{{mi.title}}                        </label>                    </div>-->                </li>            </ul>            <!--       <pre>{{vm.headers|json}}</pre>-->        </div>        <!-- Right side of the table view -->        <div style="margin-left: 16%; border-left: 1px solid gray; padding: 1em;" ng-init="poiTypeFilter">            <!-- Filter -->            <div class="has-feedback" style="margin-bottom: 1em; float: right; width: 16%; min-width: 200px;">                <span style="direction: ltr; position: static; display: block;">                    <input id="searchbox" data-ng-model="featureFilter" type="text"                           placeholder="Filter" autocomplete="off" spellcheck="false"                           style="position: relative; vertical-align: top;" class="form-control tt-input">                </span>                <span id="searchicon" class="fa form-control-feedback fa-filter" style="padding-top: 0px;"></span>            </div>            <!--Download to CSV option-->            <a href="" data-ng-click="vm.downloadCsv()" alt="Download CSV" style="margin-top: 5px; margin-right: 1em; float: right;"><i class="fa fa-floppy-o fa-2x"></i></a>            <!-- Specify how many items to show -->            <select data-ng-model="vm.numberOfItems" style="margin-bottom: 1em; margin-right: 10px; float: left; width: 16%; min-width: 200px;" class="form-control tt-input">                <option value="5">Show 5 items</option>                <option value="10">Show 10 items</option>                <option value="15">Show 15 items</option>                <option value="20">Show 20 items</option>                <option value="25">Show 25 items</option>                <option value="30">Show 30 items</option>                <option value="35">Show 35 items</option>                <option value="40">Show 40 items</option>            </select>            <!-- Data table -->            <table class="table table-striped table-condensed">                <tr>                    <th data-ng-repeat="header in vm.headers">                        {{header}}&nbsp;                        <a data-ng-click="reverseSort = !reverseSort; vm.orderBy($index, reverseSort);"><i data-ng-class="vm.sortOrderClass($index, reverseSort)">&nbsp;&nbsp;</i></a>                    </th>                </tr>                <tr dir-paginate="row in vm.rows | filter:featureFilter | itemsPerPage: vm.numberOfItems"                    style="cursor: pointer; vertical-align: central">                    <td data-ng-class="{\'text-right\': field.type == \'number\'}" data-ng-repeat="field in row track by $index" data-ng-bind-html="vm.toTrusted(field.displayValue)"></td>                </tr>            </table>            <dir-pagination-controls style="" max-size="10" boundary-links="true" direction-links="true"                                     template-url="bower_components/angular-utils-pagination/dirPagination.tpl.html"></dir-pagination-controls>        </div>    </div>    <div style="clear: both; margin: 0; padding: .5em"></div></div>'
}(DataTable||(DataTable={}));var DataTable;!function(e){var t="csWeb.datatable";e.myModule;try{e.myModule=angular.module(t)}catch(i){e.myModule=angular.module(t,[])}e.myModule.directive("datatable",["$compile",function(){return{terminal:!1,restrict:"E",scope:{},template:e.html,replace:!0,transclude:!0,controller:e.DataTableCtrl}}])}(DataTable||(DataTable={}));