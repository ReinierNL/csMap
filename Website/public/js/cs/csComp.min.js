var csComp;!function(e){!function(t){var r=function(){function e(){}return e}();t.Widget=r;var i=function(){function t(e,t){this.sizeY=2,this.sizeX=4,this.renderer=function(){},this.resize=function(){},e&&(this.title=e),t&&(this.widgetType=t),this.properties={},this.dataSets=[]}return t.prototype.init=function(t,r,i,a,n){this.sizeX=t,this.sizeY=r,this.col=i,this.row=a,this.background="red",n||(n="widget"+e.Helpers.getGuid().replace("-","")),this.id=n,this.elementId=n},t.prototype.updateDateRange=function(e){this.range=e},t}();t.BaseWidget=i;var a=function(){function e(e,t){this.id=e,this.name=t,this.widgets=[]}return e}();t.Dashboard=a;var n=function(){function e(e,t){this.id=e,this.title=t,this.data=[]}return e}();t.DataSet=n}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var csComp;!function(e){!function(e){var t=function(){function e(){var e=this;this.startDate=function(){return new Date(e.start)}}return e}();e.Event=t;var r=function(){function e(){}return e}();e.Feature=r,function(e){e[e.None=0]="None",e[e.Image=1]="Image",e[e.Point=2]="Point",e[e.Square=3]="Square",e[e.Rectangle=4]="Rectangle",e[e.Line=5]="Line",e[e.Circle=6]="Circle",e[e.Freehand=7]="Freehand",e[e.Polyline=8]="Polyline",e[e.Polygon=9]="Polygon",e[e.MultiPolygon=10]="MultiPolygon"}(e.DrawingModeType||(e.DrawingModeType={}));e.DrawingModeType;!function(e){e[e.none=0]="none",e[e.bar=1]="bar",e[e.text=2]="text"}(e.featureFilterType||(e.featureFilterType={}));var i=(e.featureFilterType,function(){function e(){}return e}());e.PropertyInfo=i}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var csComp;!function(e){!function(e){!function(e){e[e.GeoJson=0]="GeoJson",e[e.Kml=1]="Kml"}(e.LayerType||(e.LayerType={}));var t=(e.LayerType,function(){function e(){}return e}());e.ProjectGroup=t;var r=function(){function e(){}return e}();e.GroupFilter=r;var i=function(){function e(e){var t=this;this.availableAspects=["strokeColor","fillColor","strokeWidth"],this.colorScales={},e("WHITE_RED").then(function(e){t.colorScales[e]=["white","red"]}),e("RED_WHITE").then(function(e){t.colorScales[e]=["red","white"]}),e("GREEN_RED").then(function(e){t.colorScales[e]=["green","red"]}),e("RED_GREEN").then(function(e){t.colorScales[e]=["red","green"]}),e("WHITE_BLUE").then(function(e){t.colorScales[e]=["white","blue"]}),e("BLUE_WHITE").then(function(e){t.colorScales[e]=["blue","white"]}),e("WHITE_GREEN").then(function(e){t.colorScales[e]=["white","green"]}),e("GREEN_WHITE").then(function(e){t.colorScales[e]=["green","white"]}),e("WHITE_ORANGE").then(function(e){t.colorScales[e]=["white","orange"]}),e("ORANGE_WHITE").then(function(e){t.colorScales[e]=["orange","white"]})}return e}();e.GroupStyle=i}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var csComp;!function(e){!function(e){var t=function(){function e(){var e=this;this.startDate=function(){return new Date(e.start)},this.focusDate=function(){return new Date(e.start)},this.endDate=function(){return new Date(e.start)},focus||this.setFocus(new Date)}return e.prototype.setFocus=function(e,t,r){this.focus=e.getTime(),t&&(this.start=t.getTime()),r&&(this.end=r.getTime())},e}();e.DateRange=t;var r=function(){function e(){}return e}();e.Solution=r;var i=function(){function e(){}return e}();e.SolutionProject=i;var a=function(){function e(){this.markers={}}return e.prototype.deserialize=function(e){this.viewBounds=e.viewBounds,this.title=e.title,this.description=e.description,this.logo=e.logo,this.markers=e.markers,this.startposition=e.startposition,this.features=e.features,this.featureTypes=e.featureTypes,this.propertyTypeData=e.propertyTypeData,this.groups=e.groups,this.mcas=[];for(var t in e.mcas)this.mcas.push((new Mca.Models.Mca).deserialize(t));return this},e}();e.Project=a;var n=function(){function e(){}return e}();e.ProjectLayer=n}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var BaseMapList;!function(e){e.html='<div>    <h4 class="leftpanel-header" translate="MAP"></h4>    <div data-ng-repeat="(key, value) in vm.$mapService.baseLayers" style="clear:left;">        <div ng-click="vm.selectBaseLayer(key);" class="select-basestyle">            <img data-ng-src="{{value.options.preview}}" class="preview-base-layer" style="margin-bottom:5px" />            <div style="margin:3px;float:left">                <span style="font-size: 18px;font-weight: bold;">{{key}}</span><br />                {{value.options.subtitle}}            </div>        </div>    </div></div>'}(BaseMapList||(BaseMapList={}));var BaseMapList;!function(e){var t="csWeb.baseMapList";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("baseMapList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var r=50,i=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-r-i)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.BaseMapListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(BaseMapList||(BaseMapList={}));var BaseMapList;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$mapService=t,e.vm=this}return e.prototype.selectBaseLayer=function(e){var t=this.$mapService.baseLayers[e];this.$mapService.changeBaseLayer(t)},e.$inject=["$scope","mapService"],e}();e.BaseMapListCtrl=t}(BaseMapList||(BaseMapList={}));var DataTable;!function(e){e.html='<div>    <div style="width:100%; margin: 10px auto;">        <div style="float: left; width: 15%; margin: 0; padding: 1em">            <!-- Pull down of map layers -->            <select data-ng-model="vm.selectedLayerId"                    data-ng-change="vm.loadLayer()"                    data-ng-options="layer.id as layer.title group by layer.group for layer in vm.layerOptions"                    class="form-control tt-input"></select>            <!-- List of headers -->            <ul class="form-group" style="margin-top: 1em; margin-left: -2em; overflow-y: auto; overflow-x: hidden;"                resize resize-y="150">                <li ng-repeat="mi in vm.propertyTypes" class="list-unstyled" style="white-space: nowrap; text-overflow: ellipsis">                    <label>                        <input type="checkbox" name="vm.selectedTitles[]" value="{{mi.title}}"                               data-ng-checked="vm.headers.indexOf(mi.title) > -1"                               data-ng-click="vm.toggleSelection(mi.title)">&nbsp;&nbsp;{{mi.title}}                    </label>                    <!--<div class="checkbox">                        <label>                            <input type="checkbox" name="vm.selectedTitles[]" value="{{mi.title}}"                                   data-ng-checked="vm.headers.indexOf(mi.title) > -1"                                   data-ng-click="vm.toggleSelection(mi.title)">&nbsp;&nbsp;{{mi.title}}                        </label>                    </div>-->                </li>            </ul>            <!--       <pre>{{vm.headers|json}}</pre>-->        </div>        <!-- Right side of the table view -->        <div style="margin-left: 16%; border-left: 1px solid gray; padding: 1em;" ng-init="poiTypeFilter">            <!-- Filter -->            <div class="has-feedback" style="margin-bottom: 1em; float: right; width: 16%; min-width: 200px;">                <span style="direction: ltr; position: static; display: block;">                    <input id="searchbox" data-ng-model="featureFilter" type="text"                           placeholder="Filter" autocomplete="off" spellcheck="false"                           style="position: relative; vertical-align: top;" class="form-control tt-input">                </span>                <span id="searchicon" class="fa form-control-feedback fa-filter" style="padding-top: 0px;"></span>            </div>            <!--Download to CSV option-->            <a href="" data-ng-click="vm.downloadCsv()" alt="Download CSV" style="margin-top: 5px; margin-right: 1em; float: right;"><i class="fa fa-download fa-2x"></i></a>            <!-- Specify how many items to show -->            <select data-ng-model="vm.numberOfItems" style="margin-bottom: 1em; margin-right: 10px; float: left; width: 16%; min-width: 200px;" class="form-control tt-input">                <option value="5" translate="SHOW5"></option>                <option value="10" translate="SHOW10"></option>                <option value="15" translate="SHOW15"></option>                <option value="20" translate="SHOW20"></option>                <option value="25" translate="SHOW25"></option>                <option value="30" translate="SHOW30"></option>                <option value="35" translate="SHOW35"></option>                <option value="40" translate="SHOW40"></option>            </select>            <!-- Data table -->            <table class="table table-striped table-condensed">                <tr>                    <th data-ng-repeat="header in vm.headers track by $index">                        {{header}}&nbsp;                        <a data-ng-click="reverseSort = !reverseSort; vm.orderBy($index, reverseSort);"><i data-ng-class="vm.sortOrderClass($index, reverseSort)">&nbsp;&nbsp;</i></a>                    </th>                </tr>                <tr dir-paginate="row in vm.rows | filter:featureFilter | itemsPerPage: vm.numberOfItems"                    style="cursor: pointer; vertical-align: central">                    <td data-ng-class="{\'text-right\': field.type == \'number\'}" data-ng-repeat="field in row track by $index" data-ng-bind-html="vm.toTrusted(field.displayValue)"></td>                </tr>            </table>            <dir-pagination-controls style="" max-size="10" boundary-links="true" direction-links="true"                                     template-url="bower_components/angular-utils-pagination/dirPagination.tpl.html"></dir-pagination-controls>        </div>    </div>    <div style="clear: both; margin: 0; padding: .5em"></div></div>'}(DataTable||(DataTable={}));var DataTable;!function(e){var t="csWeb.datatable";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("datatable",["$compile",function(){return{terminal:!1,restrict:"E",scope:{},template:e.html,replace:!0,transclude:!0,controller:e.DataTableCtrl}}])}(DataTable||(DataTable={}));var DataTable;!function(e){var t=function(){function e(e,t,r,i){this.displayValue=e,this.originalValue=t,this.type=r,this.header=i}return e}();e.TableField=t;var r=function(){function e(e,t,r,i,a,n,o){var s=this;this.$scope=e,this.$http=t,this.$sce=r,this.$translate=i,this.$layerService=a,this.$localStorageService=n,this.$messageBusService=o,this.mapLabel="map",this.numberOfItems=10,this.layerOptions=[],this.propertyTypes=[],this.headers=[],this.rows=[],e.vm=this,i("MAP_FEATURES").then(function(e){s.layerOptions[0].title=e}),this.bindToStorage("vm.numberOfItems",10),this.numberOfItems=n.get("vm.numberOfItems"),this.bindToStorage("vm.selectedLayerId",this.mapLabel),null!=this.$layerService.project&&null!=this.$layerService.project.groups&&(this.updateLayerOptions(),this.loadLayer())}return e.prototype.bindToStorage=function(e,t){null===this.$localStorageService.get(e)&&this.$localStorageService.set(e,t),this.$localStorageService.bind(this.$scope,e)},e.prototype.updateLayerOptions=function(){var e=this;this.layerOptions.push({group:"",id:this.mapLabel,title:this.mapFeatureTitle}),null!=this.$layerService.project&&null!=this.$layerService.project.groups&&(this.$layerService.project.groups.forEach(function(t){t.layers.forEach(function(r){e.layerOptions.push({group:t.title,id:r.id,title:r.title})})}),this.selectedLayerId=this.$localStorageService.get("vm.selectedLayerId"))},e.prototype.loadLayer=function(){var e=this;if(!this.selectedLayerId||this.selectedLayerId===this.mapLabel)return this.loadMapLayers();var t=this.findLayerById(this.selectedLayerId);return null==t?this.loadMapLayers():void this.$http.get(t.url).success(function(t){e.dataset=t,null==t.featureTypes&&(t.featureTypes={}),t.features.forEach(function(r){r.featureTypeName=r.properties.FeatureTypeId,r.featureTypeName in t.featureTypes||(t.featureTypes[r.featureTypeName]=e.$layerService.featureTypes[r.featureTypeName])}),e.updatepropertyType(t)}).error(function(){e.$messageBusService.notify("ERROR opening "+t.title,"Could not get the data.")})},e.prototype.loadMapLayers=function(){var e=this;this.selectedLayerId=this.mapLabel;var t={type:"",features:[],featureTypes:{}};this.$layerService.project.groups.forEach(function(e){null!=e.filterResult&&e.filterResult.forEach(function(e){return t.features.push(e)})}),0===t.features.length&&(t.features=this.$layerService.project.features),t.features.forEach(function(r){r.featureTypeName in t.featureTypes||(t.featureTypes[r.featureTypeName]=e.$layerService.featureTypes[r.featureTypeName])}),this.dataset=t,this.updatepropertyType(t)},e.prototype.updatepropertyType=function(e){var t=this;this.propertyTypes=[],this.headers=[],this.rows=[];var r=[],i=[];i.push({label:"Name",visibleInCallOut:!0,title:"Naam",type:"text",filterType:"text",isSearchable:!0});var a;for(var n in e.featureTypes){if(a=e.featureTypes[n],null!=a.propertyTypeKeys){var o=a.propertyTypeKeys.split(";");o.forEach(function(e){if(e in t.$layerService.propertyTypeData)i.push(t.$layerService.propertyTypeData[e]);else if(null!=a.propertyTypeData){var r=$.grep(a.propertyTypeData,function(t){return t.label===e});r.length>=1&&i.push(r)}})}else null!=a.propertyTypeData&&a.propertyTypeData.forEach(function(e){return i.push(e)});i.forEach(function(e){(e.visibleInCallOut||"Name"===e.label)&&r.indexOf(e.title)<0&&(r.push(e.title),t.propertyTypes.push(e))})}for(var s=3,l=0;s>l;l++)this.headers.push(r[l]);this.rows=this.getRows()},e.prototype.toggleSelection=function(e){var t=this.headers.indexOf(e);t>-1?this.headers.splice(t,1):this.headers.push(e),this.rows=this.getRows()},e.prototype.findLayerById=function(e){for(var t=0;t<this.$layerService.project.groups.length;t++)for(var r=this.$layerService.project.groups[t],i=0;i<r.layers.length;i++){var a=r.layers[i];if(a.id==e)return a}return null},e.prototype.getRows=function(){var e=this,r=[this.headers.length];this.propertyTypes.forEach(function(t){var i=e.headers.indexOf(t.title);i>=0&&(r[i]=t)});var i,a=[];return this.dataset.features.forEach(function(e){var n=[];r.forEach(function(r){var a=e.properties[r.label];i=csComp.Helpers.convertPropertyInfo(r,a),n.push(new t(i,a,r.type,r.title))}),a.push(n)}),a},e.prototype.sortOrderClass=function(e,t){var r;return r=null!=t&&e==this.sortingColumn?"fa fa-sort-"+(t?"desc":"asc"):"fa fa-sort"},e.prototype.orderBy=function(e,t){this.sortingColumn=e,this.rows=this.rows.sort(function(r,i){var a;return a="number"==r[e].type?r[e].originalValue>i[e].originalValue:r[e].originalValue.toLowerCase()>i[e].originalValue.toLowerCase(),a==t?1:-1})},e.prototype.downloadCsv=function(){var e=[];e.push(this.headers.join(";"));for(var t=0;t<this.rows.length;t++)e.push(this.rows[t].map(function(e){return e.originalValue}).join(";"));var r=e.join("\r\n"),i=this.mapLabel;if(this.selectedLayerId!==this.mapLabel){var a=this.findLayerById(this.selectedLayerId);a&&(i=a.title.replace(" ","_"))}this.saveData(r,i+".csv")},e.prototype.saveData=function(e,t){if(navigator.msSaveBlob){var r=document.createElement("a");r.addEventListener("click",function(){var r=new Blob([e],{type:"text/csv;charset=utf-8;"});navigator.msSaveBlob(r,t)},!1),document.body.appendChild(r),r.click(),document.body.removeChild(r)}else if(csComp.Helpers.supportsDataUri()){var i=document.createElement("a");document.body.appendChild(i),i.href="data:text/csv;charset=utf-8,"+encodeURI(e),i.target="_blank",i.download=t,i.click(),document.body.removeChild(i)}else{var a=window.open("","csv","");a.document.body.innerHTML="<pre>"+e+"</pre>"}},e.prototype.toTrusted=function(e){try{return this.$sce.trustAsHtml(e.toString())}catch(t){return console.log(t+": "+e),""}},e.$inject=["$scope","$http","$sce","$translate","layerService","localStorageService","messageBusService"],e}();e.DataTableCtrl=r}(DataTable||(DataTable={}));var FeatureList;!function(e){e.html='<div style="position: relative;">    <h4 class="leftpanel-header" translate="FEATURES"></h4>    <div class="has-feedback" style="padding:10px 4px 4px 4px;">        <span style="direction: ltr; position: static; display: block;">            <input id="searchbox" data-ng-model="featureFilter.properties" type="text"                   placeholder="Filter" autocomplete="off" spellcheck="false"                   style="position: relative; vertical-align: top;" class="form-control tt-input">        </span>        <span id="searchicon" class="fa form-control-feedback fa-filter" style="padding-top: 10px;"></span>    </div>    <table class="table table-striped table-condensed">        <!--vm.$layerService.features-->        <tr dir-paginate="feature in vm.$layerService.project.features | filter:featureFilter | orderBy:\'properties.Name\' | itemsPerPage: numberOfItems "            data-ng-click="vm.$mapService.zoomTo(feature);vm.$layerService.selectFeature(feature);" style="cursor: pointer; height: 50px; vertical-align: central">            <!--<td>Icon</td>-->            <td>{{ feature.properties.Name }}</td>            <td>                <i class="fa fa-chevron-right pull-right"></i>            </td>        </tr>    </table>    <dir-pagination-controls style="position: absolute; bottom: -80px;" max-size="6" boundary-links="false" direction-links="false" template-url="bower_components/angular-utils-pagination/dirPagination.tpl.html"></dir-pagination-controls></div>'}(FeatureList||(FeatureList={}));var FeatureList;!function(e){var t="csWeb.featureList";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("featureList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var r=50,i=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-r-i)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.FeatureListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(FeatureList||(FeatureList={}));var FeatureList;!function(e){var t=function(){function e(e,t,r){this.$scope=e,this.$layerService=t,this.$mapService=r,e.vm=this,e.numberOfItems=10}return e.$inject=["$scope","layerService","mapService"],e}();e.FeatureListCtrl=t}(FeatureList||(FeatureList={}));var FeatureProps;!function(e){e.html='<div data-ng-cloak data-ng-show="showMenu" >    <h4 class="rightpanel-header">        &nbsp;&nbsp;{{callOut.title}}    </h4>        <div class="container-fluid rightpanel-tabs" style="position: relative">            <div class="row" style="overflow:hidden">            <!-- Nav tabs -->            <span id="leftArr" style="display:block;padding:10px;margin-top:5px;position:absolute;background-color:transparent;z-index:2">                <i class="glyphicon glyphicon-chevron-left"></i>            </span>            <span id="rightArr" style="display:block;padding:10px;margin-top:5px;position:absolute;background-color:transparent;z-index:2">                <i class="glyphicon glyphicon-chevron-right"></i>            </span>            <ul class="nav nav-tabs" id="featureTabs" style="margin-left:10px">                <li data-toggle="tab" data-ng-class="{active : $first}" data-ng-repeat="(sectionTitle, section) in callOut.sections" ng-if="section.hasProperties()">                    <a ng-href="#rp-{{$index}}" data-toggle="tab" data-ng-if="section.showSectionIcon()" ng-click="featureTabActivated(sectionTitle, section)"><i class="fa {{section.sectionIcon}}"></i></a>                    <a ng-href="#rp-{{$index}}" data-toggle="tab" data-ng-if="!section.showSectionIcon()" ng-click="featureTabActivated(sectionTitle, section)">{{sectionTitle}}</a>                </li>            </ul>        </div>    </div>    <div class="tab-content" style="top:50px; width:355px; overflow-y: auto; overflow-x: hidden" resize resize-y="150">        <div data-ng-if="!$last" class="tab-pane" data-ng-class="{active : $first}" id="rp-{{$index}}" data-ng-repeat="(sectionTitle, section) in callOut.sections">            <table class="table table-condensed">                <tr popover="{{(item.description) ? item.description : \'\'}}"                    popover-placement="left"                    popover-trigger="mouseenter"                    popover-append-to-body="true"                    data-ng-repeat="item in section.properties">                    <td><a class="fa fa-filter makeNarrow" data-ng-show="item.canFilter" data-ng-click="vm.$layerService.setFilter(item)" style="cursor: pointer"></a></td>                    <td><a class="fa fa-eye makeNarrow" data-ng-show="item.canStyle" data-ng-click="vm.$layerService.setStyle(item)" style="cursor: pointer"></a></td>                    <td>{{item.key}}</td>                    <td class="text-right" data-ng-bind-html="vm.toTrusted(item.value)"></td>                </tr>            </table>        </div>        <!-- Treat last tab (filter) differently -->        <div data-ng-if="$last" class="tab-pane" data-ng-class="{active : $first}" id="rp-{{$index}}" data-ng-repeat="(sectionTitle, section) in callOut.sections">            <!-- Add filter panel to the last rendered element -->            <div class="has-feedback" style="padding:0 4px 4px 4px;">                <span style="direction: ltr; position: static; display: block;">                    <input id="searchbox" data-ng-model="search.key" type="text"                            placeholder="Filter" autocomplete="off" spellcheck="false"                            style="position: relative; vertical-align: top;" class="form-control tt-input">                </span>                <span id="searchicon" class="fa form-control-feedback fa-filter"></span>            </div>            <!--<input style="padding:4px;" class=" form-control" data-ng-model="search" placeholder="...">-->            <table id="searchTextResults" class="table table-condensed">                <tr popover="{{(item.description) ? item.description : \'\'}}"                    popover-placement="left"                    popover-trigger="mouseenter"                    popover-append-to-body="true"                    data-ng-repeat="item in section.properties | filter:search">                    <td><a class="fa fa-filter makeNarrow" data-ng-show="item.canFilter" data-ng-click="vm.$layerService.setFilter(item)"></a></td>                    <td><a class="fa fa-eye makeNarrow" data-ng-show="item.canStyle" data-ng-click="vm.$layerService.setStyle(item)"></a></td>                    <td>{{item.key}}</td>                    <td class="text-right" data-ng-bind-html="vm.toTrusted(item.value)"></td>                </tr>            </table>        </div>    </div></div>'}(FeatureProps||(FeatureProps={}));var FeatureProps;!function(e){var t="csWeb.featureprops";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("featureprops",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var r=t(e);return function(e){r(e)}},replace:!0,transclude:!0,controller:e.FeaturePropsCtrl}}])}(FeatureProps||(FeatureProps={}));var FeatureProps;!function(e){var t=(function(){function e(e){this.position=e,this.closeButton=!0,this.autoPan=!0}return e}(),function(){function e(e,t,r,i,a,n,o,s,l){this.key=e,this.value=t,this.property=r,this.canFilter=i,this.canStyle=a,this.feature=n,this.isFilter=o,this.description=s,this.meta=l}return e}());e.CallOutProperty=t;var r=function(){function e(e){this.propertyTypes={},this.properties=[],this.sectionIcon=e}return e.prototype.showSectionIcon=function(){return!csComp.StringExt.isNullOrEmpty(this.sectionIcon)},e.prototype.addProperty=function(e,r,i,a,n,o,s,l,c){this.properties.push(l?new t(e,r,i,a,n,o,s,l,c):new t(e,r,i,a,n,o,s,null,c))},e.prototype.hasProperties=function(){return null!=this.properties&&this.properties.length>0},e}();e.CallOutSection=r;var i=function(){function e(e,t,i){var a=this;this.type=e,this.feature=t,this.propertyTypeData=i,this.sections={},this.setTitle();var n,o=new r("fa-info"),s=new r("fa-filter");if(null!=e){var l=[];if(null!=e.propertyTypeKeys){var c=e.propertyTypeKeys.split(";");c.forEach(function(t){if(t in i)l.push(i[t]);else if(null!=e.propertyTypeData){var r=$.grep(e.propertyTypeData,function(e){return e.label===t});r.length>=1&&l.push(r)}})}else null!=e.propertyTypeData&&(l=e.propertyTypeData);l.forEach(function(e){var r=a.getOrCreateCallOutSection(e.section)||o;r.propertyTypes[e.label]=e;var i=t.properties[e.label];if(n=csComp.Helpers.convertPropertyInfo(e,i),e.canEdit||!csComp.StringExt.isNullOrEmpty(n)){var l="number"==e.type||"text"==e.type,c="number"==e.type||"color"==e.type;null!=e.filterType&&(l="none"!=e.filterType.toLowerCase()),e.visibleInCallOut&&r.addProperty(e.title,n,e.label,l,c,t,!1,e.description,e),s.addProperty(e.title,n,e.label,l,c,t,!1,e.description)}})}o.properties.length>0&&(this.sections["AAA Info"]=o),s.properties.length>0&&(this.sections["Zzz Search"]=s)}return e.prototype.getOrCreateCallOutSection=function(e){return e?e in this.sections?this.sections[e]:(this.sections[e]=new r,this.sections[e]):null},e.prototype.setTitle=function(){this.title=e.title(this.type,this.feature)},e.title=function(e,t){var r="";return null!=e&&null!=e.style&&e.style.nameLabel?r=t.properties[e.style.nameLabel]:t.hasOwnProperty("Name")?r=t.properties.Name:t.hasOwnProperty("name")&&(r=t.properties.name),csComp.StringExt.isNullOrEmpty(r)||$.isNumeric(r)||(r=r.replace(/&amp;/g,"&")),r},e}();e.CallOut=i;var a=function(){function e(e,t,r,i,a,n){var o=this;this.$scope=e,this.$location=t,this.$sce=r,this.$mapService=i,this.$layerService=a,this.$messageBusService=n,this.sidebarMessageReceived=function(e){switch(e){case"toggle":o.$scope.showMenu=!o.$scope.showMenu;break;case"show":o.$scope.showMenu=!0;break;case"hide":o.$scope.showMenu=!1}"$apply"!=o.$scope.$root.$$phase&&"$digest"!=o.$scope.$root.$$phase&&o.$scope.$apply()},this.featureMessageReceived=function(e,t){switch(e){case"onFeatureSelect":o.displayFeature(t),o.$scope.poi=t,o.$scope.autocollapse(!0);break;case"onFeatureUpdated":o.displayFeature(o.$layerService.lastSelectedFeature),o.$scope.poi=o.$layerService.lastSelectedFeature}"$apply"!=o.$scope.$root.$$phase&&"$digest"!=o.$scope.$root.$$phase&&o.$scope.$apply()},this.scope=e,e.vm=this,e.showMenu=!1,e.featureTabActivated=function(e,t){n.publish("FeatureTab","activated",{sectionTitle:e,section:t})},n.subscribe("sidebar",this.sidebarMessageReceived),n.subscribe("feature",this.featureMessageReceived);var s=function(){var e=0;return $("#featureTabs>li").each(function(){var t=$(this).outerWidth();e+=t}),e};e.autocollapse=function(e){"undefined"==typeof e&&(e=!1);var t=$("#featureTabs");t.outerWidth()<s()||parseFloat(t.css("margin-left"))<0?($("#leftArr").show(),$("#rightArr").show(),e&&t.animate({"margin-left":"20px"},"slow")):($("#leftArr").hide(),$("#rightArr").hide(),e&&t.animate({"margin-left":"0px"},"slow"))},e.autocollapse(!0),e.tabs=$("#featureTabs"),e.tabScrollDelta=e.tabs.outerWidth(),$("#leftArr").click(function(){var t=parseFloat(e.tabs.css("margin-left")),r=20,i=e.tabScrollDelta;t+i>r&&(i=r-t),e.tabs.animate({"margin-left":"+="+i+"px"},"slow",function(){$("#rightArr").show(),$("#leftArr").show(),e.autocollapse(!1)})}),$("#rightArr").click(function(){var t=s()-e.tabs.outerWidth()+30,r=e.tabScrollDelta;r=Math.min(t,r),e.tabs.animate({"margin-left":"-="+r+"px"},"slow",function(){$("#leftArr").show(),$("#rightArr").show(),e.autocollapse(!1)})})}return e.prototype.toTrusted=function(e){try{return this.$sce.trustAsHtml(e.toString())}catch(t){return console.log(t+": "+e),""}},e.prototype.displayFeature=function(e){if(e){var t=this.$layerService.featureTypes[e.featureTypeName];this.$scope.callOut=new i(t,e,this.$layerService.propertyTypeData)}},e.$inject=["$scope","$location","$sce","mapService","layerService","messageBusService"],e}();e.FeaturePropsCtrl=a}(FeatureProps||(FeatureProps={}));var FilterList;!function(e){e.html='<div>    <h4 class="leftpanel-header" translate="FILTERS"></h4>    <div ng-show="vm.$layerService.noFilters" translate="FILTER_INFO"></div>    <a ng-hide="vm.$layerService.noFilters" ng-click="vm.$layerService.resetFilters()"><span class="fa fa-refresh"></span> reset</a>    <div id="filterChart"></div></div>'}(FilterList||(FilterList={}));var FilterList;!function(e){var t="csWeb.filterList";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("filterList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var r=50,i=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-r-i)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.FilterListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(FilterList||(FilterList={}));var FilterList;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$layerService=t,e.vm=this}return e.$inject=["$scope","layerService"],e}();e.FilterListCtrl=t}(FilterList||(FilterList={}));var LayersDirective;!function(e){e.html='<div>    <h4 class="leftpanel-header" translate="LAYERS"></h4>    <div data-ng-repeat="group in vm.$layerService.project.groups" style="margin-left: 5px">        <div style="float: left; margin-left: -10px; margin-top: 5px" data-toggle="collapse" data-target="#layergroup_{{group.id}}"><i class="fa fa-chevron-down togglebutton toggle-arrow-down"></i><i class="fa fa-chevron-up togglebutton toggle-arrow-up"></i></div>        <div popover="{{(group.description) ? group.description : \'\'}}"             popover-placement="right"             popover-width="400"             popover-trigger="mouseenter"             class="group-title">{{group.title}}</div>        <div id="layergroup_{{group.id}}" class="collapse in">            <div popover="{{(layer.description) ? layer.description : \'\'}}"                 popover-placement="right"                 popover-trigger="mouseenter"                                  data-ng-repeat="layer in group.layers">                <!--bs-popover>-->                <div style="list-style-type: none; padding: 0;" data-ng-class="{indent: layer.isSublayer}">                    <!--<button type="button" class="btn btn-default" data-container="body" data-toggle="popover" data-placement="right" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." data-original-title="" title="">Right</button>-->                    <div ng-hide="group.oneLayerActive" class="checkbox checkbox-primary" style="margin-left: 20px">                        <input type="checkbox" id="cblayer{{layer.id}}" ng-model="layer.enabled" data-ng-click="vm.toggleLayer(layer);">                        <label for="cblayer{{layer.id}}">                            {{layer.title}}                        </label>                    </div>                    <div ng-show="group.oneLayerActive" class="radio radio-primary" style="margin-left: 20px">                        <input type="radio" ng-value="true" id="rblayer{{layer.id}}" ng-model="layer.enabled" data-ng-click="vm.toggleLayer(layer);">                        <label for="rblayer{{layer.id}}">                            {{layer.title}}                        </label>                    </div>                </div>            </div>        </div>    </div></div>'
}(LayersDirective||(LayersDirective={}));var LayersDirective;!function(e){var t="csWeb.layersDirective";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("layersDirective",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var r=t(e);return function(e){r(e)}},replace:!0,transclude:!0,controller:e.LayersDirectiveCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(LayersDirective||(LayersDirective={}));var LayersDirective;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$layerService=t,e.vm=this}return e.prototype.toggleLayer=function(e){e.enabled=!e.enabled,e.enabled?this.$layerService.addLayer(e):this.$layerService.removeLayer(e),"$apply"!=this.$scope.$root.$$phase&&"$digest"!=this.$scope.$root.$$phase&&this.$scope.$apply()},e.$inject=["$scope","layerService"],e}();e.LayersDirectiveCtrl=t}(LayersDirective||(LayersDirective={}));var LegendList;!function(e){e.html='<div style="position: relative;">    <h4 class="leftpanel-header" translate="LEGEND"></h4>        <div>        <div ng-repeat="legendItem in legendItems" class="legendItem">            <div class="legendIcon">                <img ng-src="{{legendItem.uri}}" class="legendImage" />            </div><span class="legendText">                {{legendItem.title}}            </span>        </div>    </div></div>'}(LegendList||(LegendList={}));var LegendList;!function(e){var t="csWeb.legendList";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("legendList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var r=50,i=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-r-i)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.LegendListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(LegendList||(LegendList={}));var LegendList;!function(e){var t=function(){function e(e,t,r,i){var a=this;this.$scope=e,this.$layerService=t,this.$mapService=r,this.$messageBusService=i,e.vm=this,i.subscribe("project",function(){a.updateLegendItems()}),i.subscribe("layer",function(){a.updateLegendItems()}),this.updateLegendItems(),e.legendItems=[],e.numberOfItems=10}return e.prototype.updateLegendItems=function(){var e=[],t=[];for(var r in this.$layerService.featureTypes){var i=this.$layerService.featureTypes[r],a=this.getImageUri(i),n=this.getName(r,i),o=name+a;t.indexOf(o)<0&&(t.push(o),e.push({title:n,uri:a}))}e.sort(function(e,t){return e.title>t.title?1:e.title<t.title?-1:0}),this.$scope.legendItems=e},e.prototype.getImageUri=function(e){return null!=e.style&&null!=e.style.drawingMode&&"point"!=e.style.drawingMode.toLowerCase()?e.style.iconUri&&e.style.iconUri.indexOf("_Media")<0?e.style.iconUri:"includes/images/polygon.png":null!=e.style&&null!=e.style.iconUri?e.style.iconUri:"includes/images/marker.png"},e.prototype.getName=function(e,t){return null!=t.name?t.name:e},e.$inject=["$scope","layerService","mapService","messageBusService"],e}();e.LegendListCtrl=t}(LegendList||(LegendList={}));var Mca;!function(e){e.html='<div>    <h4 class="leftpanel-header">MCA</h4>    <div>        <select data-ng-model="vm.mca"                data-ng-options="mca.title for mca in vm.availableMcas"                style="width: 75%; margin-bottom:10px;"></select>        <a href="" data-ng-click="vm.createMca()" class="pull-right" style="margin-right:5px;"><i class="fa fa-plus"></i></a>        <a href="" data-ng-click="vm.removeMca(vm.mca)" class="pull-right" style="margin-right:5px;"><i class="fa fa-trash"></i></a>        <a href="" data-ng-click="vm.editMca(vm.mca)" class="pull-right" style="margin-right:5px;"><i class="fa fa-edit"></i></a>    </div>        <!--MCA EDITOR DIALOG-->    <div id="mcaEditorView">        <!--<input type="checkbox" ng-model="showDialog"> Show-->        <div show-modal="vm.showDialog" class="modal fade">            <div class="modal-dialog" data-ng-controller="mcaEditorCtrl">                <div class="modal-content">                    <div class="modal-header">                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                        <h3 class="modal-title" translate>MCA.EDITOR_TITLE</h3>                    </div>                    <div class="modal-body">                        <input type="text" data-ng-model="vm.mcaTitle" placeholder="{{ \'MCA.TITLE\' | translate }}" />                        <span><input type="checkbox" data-ng-model="vm.hasRank" style="margin-left: 10px;" /><span translate>MCA.INCLUDE_RANK</span></span>                        <input type="text" data-ng-if="vm.hasRank" data-ng-model="vm.rankTitle" placeholder="{{ \'MCA.RANK_TITLE\' | translate }}" />                        <h4 translate>MCA.MAIN_FEATURE</h4>                        <select data-ng-model="vm.selectedFeatureType"                                data-ng-change="vm.loadPropertyTypes()"                                data-ng-options="item as item.name for (key, item) in vm.dataset.poiTypes"                                class="form-control"></select>                        <h4 translate>MCA.PROPERTIES</h4>                        <ul class="form-group" style="margin-top: 1em; margin-left: -2em; overflow-y: auto; overflow-x: hidden;"                            resize resize-y="450">                            <li ng-repeat="mi in vm.metaInfos" class="list-unstyled" style="white-space: nowrap; -moz-text-overflow: ellipsis; text-overflow: ellipsis">                                <div>                                    <span>                                        <input type="checkbox" name="vm.selectedTitles[]" value="{{mi.title}}"                                               data-ng-checked="mi.isSelected"                                               data-ng-click="mi.isSelected = !mi.isSelected">&nbsp;&nbsp;{{mi.title}}                                        <span data-ng-if="mi.isSelected" style="margin-left: 10px;">                                            <input type="checkbox" data-ng-model="mi.hasCategory" /><span translate>MCA.HAS_CATEGORY</span>                                            <input type="text" data-ng-if="mi.hasCategory" data-ng-model="mi.category" placeholder="..." />                                        </span>                                    </span>                                    <form data-ng-if="mi.isSelected" name="myForm" style="margin-left: 20px;">                                        <label id="scoringFunctions" data-ng-repeat="sf in vm.scoringFunctions">                                            <input type="radio" data-ng-model="mi.scoringFunctionType" value="{{sf.type}}">                                            <a data-ng-href="" data-ng-class="sf.cssClass" data-ng-click="mi.isSelected = !mi.isSelected"></a>                                        </label>                                    </form>                                    <div data-ng-if="mi.scoringFunctionType == 0" style="margin-left: 20px;">                                        input -> score:&nbsp;<input type="text" data-ng-model="mi.scores" placeholder="[x0,y0 x1,y1 ...]" />                                    </div>                                </div>                            </li>                        </ul>                    </div>                    <div class="modal-footer">                        <button type="button" class="btn btn-warning" data-dismiss="modal" data-ng-click="vm.cancel()" translate>CANCEL_BTN</button>                        <button type="button" class="btn btn-primary" data-dismiss="modal" data-ng-disabled="vm.isDisabled()" data-ng-click="vm.save()" translate>OK_BTN</button>                    </div>                </div><!-- /.modal-content -->            </div><!-- /.modal-dialog -->        </div>    </div>    <div data-ng-if="vm.mca">        <ul class="list-unstyled">            <li data-ng-repeat="criterion in vm.mca.criteria">                <div data-ng-style="{\'display\': \'inline-block\', \'margin-bottom\': \'6px\', \'width\':\'10px\', \'height\':\'10px\', \'border\':\'solid 1px black\', \'background-color\': criterion.color}"></div>                <div class="truncate" style="display: inline-block; width: 170px;">{{criterion.getTitle()}}</div>                <div rating class="pull-right" style="margin:0 10px;" ng-model="criterion.userWeight" max="{{vm.mca.userWeightMax}}" readonly="isReadonly"                        state-on="\'fa fa-circle\'" state-off="\'fa fa-circle-o\'"                        data-ng-click="vm.weightUpdated(criterion)"                        on-hover="hoveringOver(value)" on-leave="overStar = null"></div>                <ul class="list-unstyled" style="margin-left: 10px;" data-ng-if="criterion.criteria.length > 0">                    <li data-ng-repeat="crit in criterion.criteria">                        <div data-ng-style="{\'display\': \'inline-block\', \'margin-bottom\': \'6px\', \'width\':\'10px\', \'height\':\'10px\', \'border\':\'solid 1px black\', \'background-color\': crit.color}">                        </div>                        <div class="truncate" style="display: inline-block; width: 150px;">{{crit.getTitle()}}</div>                        <div rating class="pull-right" style="margin:0 10px;" ng-model="crit.userWeight" max="{{vm.mca.userWeightMax}}" readonly="isReadonly"                             state-on="\'fa fa-circle\'" state-off="\'fa fa-circle-o\'"                             data-ng-click="vm.weightUpdated(crit)"                             on-hover="hoveringOver(value)" on-leave="overStar = null"></div>                    </li>                </ul>            </li>        </ul>        <!--<a href="" style="display: inline-block; width: 100%; text-transform: uppercase"           data-ng-click="vm.calculateMca()" translate="MCA.COMPUTE_MGS" translate-values="{ mcaTitle: vm.mca.title }"></a>-->        <h4 data-ng-if="vm.showChart">            <a href="" data-ng-click="vm.weightUpdated(vm.mca)" translate="MCA.TOTAL_RESULT"></a>            <a href="" data-ng-if="vm.selectedCriterion">&gt;&nbsp;{{vm.selectedCriterion.title}}</a>        </h4>        <div style="margin-top: 5px; margin-left: 70px;" id="mcaPieChart"></div>        <div data-ng-if="vm.showFeature">            <h4>{{vm.selectedFeature.properties[\'Name\']}}</h4>            <table class="table table-condensed">                <tr data-ng-repeat="item in vm.properties"                    popover="{{item.description}}"                    popover-placement="right"                    popover-trigger="mouseenter"                    popover-append-to-body="true">                    <td><a class="fa fa-filter makeNarrow" data-ng-if="item.canFilter" data-ng-click="vm.$layerService.setFilter(item)" style="cursor: pointer"></a></td>                    <td><a class="fa fa-eye makeNarrow" data-ng-if="item.canStyle" data-ng-click="vm.setStyle(item)" style="cursor: pointer"></a></td>                    <td>{{item.key}}</td>                    <td class="text-right">{{item.value}}</td>                </tr>            </table>        </div>        <i data-ng-if="!vm.showFeature"><div translate="MCA.SHOW_FEATURE_MSG"></div></i>    </div></div>'}(Mca||(Mca={}));var Mca;!function(e){var t="csWeb.mca";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("mca",["$window","$compile",function(t,r){return{terminal:!0,restrict:"EA",scope:{},template:e.html,compile:function(e){var t=r(e);return function(e){t(e)}},replace:!0,transclude:!0,controller:e.McaCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(Mca||(Mca={}));var Mca;!function(e){var t=function(){function t(r,i,a,n,o,s){var l=this;this.$scope=r,this.$modal=i,this.$translate=a,this.$localStorageService=n,this.$layerService=o,this.messageBusService=s,this.showDialog=!1,this.availableMcas=[],this.mcaMessageReceived=function(e,t){if(t&&t.mca)switch(e){case"add":l.addMca(t.mca);break;case"delete":l.deleteMca(t.mca)}},this.featureMessageReceived=function(e,t){if(null!=l.mca){switch(e){case"onFeatureSelect":l.updateSelectedFeature(t);break;case"onFeatureDeselect":l.showFeature=!1,l.selectedFeature=null,l.drawChart();break;default:console.log(e)}"$apply"!=l.$scope.$root.$$phase&&"$digest"!=l.$scope.$root.$$phase&&l.$scope.$apply()}},r.vm=this,s.subscribe("layer",function(e){switch(e){case"activated":case"deactivate":l.updateAvailableMcas(),l.calculateMca()}}),s.subscribe("project",function(r){switch(r){case"loaded":("undefined"==typeof o.project.mcas||null==o.project.mcas)&&(o.project.mcas=[]);var i=l.$localStorageService.get(t.mcas);if("undefined"==typeof i||null===i)return;i.forEach(function(t){o.project.mcas.push((new e.Models.Mca).deserialize(t))}),l.createDummyMca()}}),s.subscribe("feature",this.featureMessageReceived),s.subscribe("mca",this.mcaMessageReceived),a("MCA_DELETE_MSG").then(function(e){t.confirmationMsg1=e}),a("MCA_DELETE_MSG2").then(function(e){t.confirmationMsg2=e})}return t.prototype.createDummyMca=function(){var t=new e.Models.Mca;t.title="Mijn Zelfredzaamheid",t.description="Analyse van de zelfredzaamheid van een gemeente.",t.label="mca_zelfredzaamheid",t.stringFormat="{0:0.0}",t.rankTitle="Positie",t.rankDescription="Relatieve positie in de lijst.",t.rankFormat="{0} van {1}",t.userWeightMax=5,t.featureIds=["cities_Default"];var r=new e.Models.Criterion;r.label="p_00_14_jr",r.scores="[0,0 20,1]",r.userWeight=1,t.criteria.push(r),r=new e.Models.Criterion,r.label="p_15_24_jr",r.scores="[0,0 20,1]",r.userWeight=1,t.criteria.push(r),r=new e.Models.Criterion,r.label="p_65_eo_jr",r.scores="[0,0 25,1]",r.userWeight=3,t.criteria.push(r),this.$layerService.project.mcas.push(t),t=new e.Models.Mca,t.title="test",t.label="mca_test",t.stringFormat="{0:0.0}",t.rankTitle="Rang",t.rankFormat="{0} van {1}",t.userWeightMax=3,t.featureIds=["cities_Default"],r=new e.Models.Criterion,r.label="p_15_24_jr",r.scores="[0,0 20,1]",r.userWeight=1,t.criteria.push(r),r=new e.Models.Criterion,r.label="p_65_eo_jr",r.scores="[0,0 25,1]",r.userWeight=3,t.criteria.push(r),this.$layerService.project.mcas.push(t)},t.prototype.weightUpdated=function(e){this.addMca(this.mca),this.calculateMca(),this.drawChart(e)},t.prototype.editMca=function(e){this.messageBusService.publish("mca","edit",{mca:e}),this.showDialog=!0},t.prototype.createMca=function(){this.messageBusService.publish("mca","create"),this.showDialog=!0},t.prototype.removeMca=function(e){var r=this;if(e){var i=String.format(t.confirmationMsg1,e.title);this.messageBusService.confirm(i,t.confirmationMsg2,function(t){t&&r.deleteMca(e)})}},t.prototype.getMcaIndex=function(e){for(var t=-1,r=this.$layerService.project.mcas,i=0;i<r.length;i++)if(r[i].title==e.title){t=i;break}return t},t.prototype.addMca=function(e){e&&(this.deleteMca(e),this.$layerService.project.mcas.push(e),this.addMcaToLocalStorage(e),this.updateAvailableMcas(),this.mca=e,this.calculateMca(),this.drawPieChart())},t.prototype.deleteMca=function(e){if(e){var t=this.getMcaIndex(e),r=this.$layerService.project.mcas;t>=0&&r.splice(t,1),this.removeMcaFromLocalStorage(e),this.updateAvailableMcas(),this.availableMcas.length>0&&(this.mca=this.availableMcas[0],this.calculateMca(),this.drawPieChart())}},t.prototype.addMcaToLocalStorage=function(e){var r=this.$localStorageService.get(t.mcas);("undefined"==typeof r||null===r)&&(r=[]),this.removeMcaFromLocalStorage(e),r.push(e),this.$localStorageService.set(t.mcas,r)},t.prototype.removeMcaFromLocalStorage=function(e){var r=this.$localStorageService.get(t.mcas);if("undefined"!=typeof r&&null!==r){for(var i=-1,a=0;a<r.length;a++)if(r[a].title==e.title){i=a;break}0>i||(r.splice(i,1),this.$localStorageService.set(t.mcas,r))}},t.prototype.updateSelectedFeature=function(e){if("undefined"!=typeof e&&null!=e&&(this.selectedFeature=e,this.mca.label in e.properties)){this.showFeature=!0,this.properties=[];var r=t.createMetaInfo(this.mca),i=csComp.Helpers.convertPropertyInfo(r,e.properties[r.label]);this.properties.push(new FeatureProps.CallOutProperty(r.title,i,r.label,!0,!0,e,!1,r.description)),this.mca.rankTitle&&(r=t.createMetaInfoRank(this.mca),i=csComp.Helpers.convertPropertyInfo(r,e.properties[r.label]),this.properties.push(new FeatureProps.CallOutProperty(r.title,i,r.label,!1,!1,e,!1,r.description))),this.drawChart()}},t.prototype.drawChart=function(e){this.showChart=!0,this.showFeature?this.drawAsterPlot(e):this.drawPieChart(e)},t.prototype.getParentOfSelectedCriterion=function(e){var t,r=this;return this.mca.update(),"undefined"==typeof e||this.mca.criteria.indexOf(e)>=0?(this.selectedCriterion=null,t=this.mca.criteria):this.mca.criteria.forEach(function(i){i.criteria.indexOf(e)>=0&&(r.selectedCriterion=i,t=i.criteria)}),t},t.prototype.drawAsterPlot=function(e){var t=this;if(this.mca&&this.selectedFeature){var r=this.getParentOfSelectedCriterion(e);if("undefined"!=typeof r&&null!=r){var i=[],a=0;r.forEach(function(e){var r=new csComp.Helpers.AsterPieData;r.id=a++,r.label=e.getTitle(),r.weight=e.weight,r.color=e.color,r.score=100*e.getScore(t.selectedFeature),i.push(r)}),csComp.Helpers.Plot.drawAsterPlot(100,i,"mcaPieChart")}}},t.prototype.drawPieChart=function(e){if(this.mca){var t=this.getParentOfSelectedCriterion(e);if("undefined"!=typeof t&&null!=t){var r=[],i=0;t.forEach(function(e){var t=new csComp.Helpers.PieData;t.id=i++,t.label=e.getTitle(),t.weight=e.weight,t.color=e.color,r.push(t)}),csComp.Helpers.Plot.drawPie(100,r,"mcaPieChart")}}},t.prototype.updateAvailableMcas=function(){var e=this;this.showChart=!1,this.mca=null,this.availableMcas=[],this.$layerService.project.mcas.forEach(function(t){t.featureIds.forEach(function(r){if(e.availableMcas.indexOf(t)<0&&r in e.$layerService.featureTypes){e.availableMcas.push(t);var i=e.$layerService.featureTypes[r];e.applyPropertyInfoToCriteria(t,i)}})}),this.availableMcas.length>0&&(this.mca=this.availableMcas[0])},t.prototype.calculateMca=function(){var e=this;if(this.mca){var t=this.mca;t.featureIds.forEach(function(r){if(r in e.$layerService.featureTypes){e.addPropertyInfo(r,t);var i=[];e.$layerService.project.features.forEach(function(e){i.push(e)}),t.updatePla(i),t.update();var a=[],n=0;if(e.$layerService.project.features.forEach(function(r){var i=t.getScore(r);if(t.rankTitle){var o={score:i,index:n++};a.push(o)}r.properties[t.label]=100*i,e.$layerService.updateFeature(r)}),t.rankTitle){a.sort(function(e,t){return t.score-e.score});for(var o=e.$layerService.project.features.length,s=-1,l=1,c=0;o>c;c++){var p=a[c];p.score!=s&&(l=c+1),s=p.score,e.$layerService.project.features[p.index].properties[t.label+"#"]=l+","+o}}}}),this.updateSelectedFeature(this.selectedFeature),this.selectedFeature&&this.messageBusService.publish("feature","onFeatureSelect",this.selectedFeature),this.groupStyle&&this.$layerService.updateStyle(this.groupStyle)}},t.prototype.applyPropertyInfoToCriteria=function(e,t){e.criteria.forEach(function(e){var r=e.label;t.propertyTypeData.forEach(function(t){t.label===r&&(e.title=t.title,e.description=t.description)})})},t.prototype.addPropertyInfo=function(e,r){var i=this.$layerService.featureTypes[e];if(!i.propertyTypeData.reduce(function(e,t){return e||t.label===r.label},!1)){var a=t.createMetaInfo(r);i.propertyTypeData.push(a),r.rankTitle&&(a=t.createMetaInfoRank(r),i.propertyTypeData.push(a))}},t.prototype.setStyle=function(e){this.groupStyle?this.$layerService.updateStyle(this.groupStyle):(this.groupStyle=this.$layerService.setStyle(e,!1),this.groupStyle.colors=["red","green"],this.$layerService.updateStyle(this.groupStyle))},t.createMetaInfo=function(e){var t={title:e.title,label:e.label,type:"number",maxValue:1,minValue:0,description:e.description,stringFormat:e.stringFormat,section:e.section||"MCA"};return t},t.createMetaInfoRank=function(e){var t={title:e.rankTitle,label:e.label+"#",type:"rank",description:e.rankDescription,stringFormat:e.rankFormat,section:e.section||"MCA"};return t},t.mcas="MCAs",t.$inject=["$scope","$modal","$translate","localStorageService","layerService","messageBusService"],t}();e.McaCtrl=t}(Mca||(Mca={}));var Mca;!function(e){"use strict";var t=function(){function t(t,r,i,a){var n=this;this.$scope=t,this.$modal=r,this.$layerService=i,this.messageBusService=a,this.metaInfos=[],this.headers=[],this.scoringFunctions=[],t.vm=this,this.scoringFunctions.push(new e.Models.ScoringFunction(1)),this.scoringFunctions.push(new e.Models.ScoringFunction(2)),this.scoringFunctions.push(new e.Models.ScoringFunction(3)),this.scoringFunctions.push(new e.Models.ScoringFunction(4)),this.scoringFunctions.push(new e.Models.ScoringFunction(5)),this.scoringFunctions.push(new e.Models.ScoringFunction(6)),this.scoringFunctions.push(new e.Models.ScoringFunction(0)),a.subscribe("layer",function(e){switch(e){case"activated":case"deactivate":n.loadMapLayers()}}),a.subscribe("mca",function(e,t){switch(e){case"edit":var r=t.mca;n.mcaTitle=r.title,n.rankTitle=r.rankTitle,n.hasRank=""!=n.rankTitle,n.selectedFeatureType=n.dataset.featureTypes[r.featureIds[0]],n.updateMetaInfo(n.selectedFeatureType),n.updateMetaInfoUponEdit(r);break;case"create":n.mcaTitle="",n.rankTitle="",n.hasRank=!1,n.selectedFeatureType=null,n.loadMapLayers()}})}return t.prototype.updateMetaInfoUponEdit=function(e,t){var r=this;e.criteria.forEach(function(e){if(e.label)for(var i in r.metaInfos){var a=r.metaInfos[i];if(a.label==e.label){a.isSelected=!0,t&&(a.hasCategory=!0,a.category=t);break}}else r.updateMetaInfoUponEdit(e,e.title)})},t.prototype.loadPropertyTypes=function(){console.log("loadPropertyTypes")},t.prototype.loadMapLayers=function(){var e=this,t={type:"",features:[],featureTypes:{}};this.$layerService.project.groups.forEach(function(e){null!=e.filterResult&&e.filterResult.forEach(function(e){return t.features.push(e)})}),0===t.features.length&&(t.features=this.$layerService.project.features),t.features.forEach(function(r){t.featureTypes.hasOwnProperty(r.featureTypeName)||(t.featureTypes[r.featureTypeName]=e.$layerService.featureTypes[r.featureTypeName])}),this.dataset=t;for(var r in t.featureTypes)return this.selectedFeatureType=t.featureTypes[r],void this.updateMetaInfo(this.selectedFeatureType)},t.prototype.updateMetaInfo=function(e){var t=this;this.metaInfos=[],this.headers=[];var r=[],i=[];if(i.push({label:"Name",visibleInCallOut:!0,title:"Naam",type:"text",filterType:"text",isSelected:!1,scoringFunctionType:this.scoringFunctions[0].type}),null!=e.propertyTypeKeys){var a=e.propertyTypeKeys.split(";");a.forEach(function(r){if(r in t.$layerService.propertyTypeData)i.push(t.$layerService.propertyTypeData[r]);else if(null!=e.propertyTypeData){var a=$.grep(e.propertyTypeData,function(e){return e.label===r});a.length>=1&&i.push(a)}})}else null!=e.propertyTypeData&&e.propertyTypeData.forEach(function(e){return i.push(e)});i.forEach(function(e){e.visibleInCallOut&&"number"===e.type&&e.label.indexOf("mca_")<0&&r.indexOf(e.title)<0&&(r.push(e.title),t.metaInfos.push(e))})},t.prototype.toggleSelection=function(e){var t=this.headers.indexOf(e);t>-1?this.headers.splice(t,1):this.headers.push(e)},t.prototype.isDisabled=function(){return"undefined"==typeof this.mcaTitle||0===this.mcaTitle.length?!0:this.hasRank&&this.rankTitle&&0===this.rankTitle.length?!0:this.metaInfos.reduce(function(e,t){return e||t.isSelected})?!1:!0},t.prototype.save=function(){var t=new e.Models.Mca;t.title=this.mcaTitle||"New MCA criterion",t.label="mca_"+t.title.replace(" ","_"),t.stringFormat="{0:0.0}",this.hasRank&&(t.rankTitle=this.rankTitle||"Rank",t.rankFormat="{0} / {1}"),t.userWeightMax=5;for(var r in this.dataset.featureTypes)this.dataset.featureTypes[r]===this.selectedFeatureType&&(t.featureIds=[r]);this.metaInfos.forEach(function(r){if(r.isSelected){var i=new e.Models.Criterion;if(i.label=r.label,i.title=r.title,i.isPlaScaled=!0,i.description=r.description,i.userWeight=1,0===r.scoringFunctionType?i.scores=r.scores:(i.scores=e.Models.ScoringFunction.createScores(r.scoringFunctionType),i.isPlaScaled=!0),r.category){var a;for(var n in t.criteria){var o=t.criteria[n];if(o.title==r.category){a=o;break}}null==a&&(a=new e.Models.Criterion,a.title=r.category,a.isPlaUpdated=!1,t.criteria.push(a)),a.criteria.push(i)}else t.criteria.push(i)}}),this.messageBusService.publish("mca","add",{mca:t})},t.prototype.cancel=function(){this.mcaTitle="",this.hasRank=!1,this.rankTitle="",this.headers=[]},t.$inject=["$scope","$modal","layerService","messageBusService"],t}();e.McaEditorCtrl=t}(Mca||(Mca={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r},Mca;!function(e){!function(e){!function(e){e[e.Manual=0]="Manual",e[e.Ascending=1]="Ascending",e[e.Descending=2]="Descending",e[e.AscendingSigmoid=3]="AscendingSigmoid",e[e.DescendingSigmoid=4]="DescendingSigmoid",e[e.GaussianPeak=5]="GaussianPeak",e[e.GaussianValley=6]="GaussianValley"}(e.ScoringFunctionType||(e.ScoringFunctionType={}));var t=e.ScoringFunctionType,r=function(){function e(e){"undefined"!=typeof e&&null!=e&&(this.type=e)}return Object.defineProperty(e.prototype,"cssClass",{get:function(){return t[this.type].toLowerCase()},enumerable:!0,configurable:!0}),e.createScores=function(e){var t;switch(e){default:case 1:t="[0,0 10,1]";break;case 2:t="[0,1 10,0]";break;case 3:t="[0,0.11 1,0.12 2,0.14 3,0.18 4,0.28 5,0.5 6,0.72 7,0.82 8,0.86 9,0.88 10,0.89]";break;case 4:t="[0,0.89 1,0.88 2,0.86 3,0.82 4,0.72 5,0.5 6,0.28 7,0.18 8,0.14 9,0.12 10,0.11]";break;case 5:t="[0,0 2,0.04 3,0.25 4,0.7 5,1 6,0.7 7,0.25 8,0.04 9,0]";break;case 6:t="[0,1 2,0.96 3,0.75 4,0.3 5,0 6,0.3 7,0.75 8,0.96 9,0]"}return t},e}();e.ScoringFunction=r;var i=function(){function e(){}return e}();e.ScoringFunctions=i;var a=function(){function t(){this.userWeight=1,this.criteria=[],this.isPlaUpdated=!1,this.isPlaScaled=!1,this.x=[],this.y=[]}return t.prototype.deserialize=function(t){var r=this;return this.title=t.title,this.description=t.description,this.label=t.label,this.color=t.color,this.userWeight=t.userWeight,this.weight=t.weight,this.isPlaScaled=t.isPlaScaled,this.scores=t.scores,t.criteria.forEach(function(t){r.criteria.push((new e.Criterion).deserialize(t))}),this},t.prototype.requiresMinimum=function(){return this.scores&&this.scores.indexOf("min")>=0},t.prototype.requiresMaximum=function(){return this.scores&&this.scores.indexOf("max")>=0},t.prototype.getTitle=function(){return this.title?this.title:this.label},t.prototype.updatePla=function(e){var t=this;if(!this.isPlaUpdated){if(this.criteria.length>0)return this.criteria.forEach(function(t){t.updatePla(e)}),void(this.isPlaUpdated=!0);var r=this.scores,i=[];(this.requiresMaximum()||this.requiresMinimum()||this.isPlaScaled)&&e.forEach(function(e){t.label in e.properties&&i.push(e.properties[t.label])});var a=0,n=0;(this.isPlaScaled||this.requiresMaximum())&&(a=Math.max.apply(null,i),r.replace("max",a.toPrecision(3))),(this.isPlaScaled||this.requiresMinimum())&&(n=Math.min.apply(null,i),r.replace("min",n.toPrecision(3)));var o=r.split(/[^\d\.]+/).filter(function(e){return e.length>0}),s=a-n,l=.08*s,c=n+.1*s;if(o.length%2!=0)throw Error(this.label+" does not have an even (x,y) pair in scores.");for(var p=0;p<o.length/2;p++){var u=parseFloat(o[2*p]);if(this.isPlaScaled&&(u=l*u+c),p>0&&this.x[p-1]>u)throw Error(this.label+": x should increment continuously.");this.x.push(u);var d=parseFloat(o[2*p+1]);0>d?d=0:d>1&&(d=1),this.y.push(d)}this.isPlaUpdated=!0}},t.prototype.getScore=function(e){if(!this.isPlaUpdated)throw"Error: PLA must be updated for criterion "+this.title+"!";if(0!=this.criteria.length){var t=0;return this.criteria.forEach(function(r){t+=r.weight*r.getScore(e)}),this.weight*t}if(!(this.label in e.properties))return 0;var r=e.properties[this.label];if(r<this.x[0])return this.y[0];var i=this.x.length-1;if(r>this.x[i])return this.y[i];for(var a in this.x)if(r<this.x[a]){var n=this.x[a-1],o=this.x[a],s=this.y[a-1],l=this.y[a];return(l-s)*(r-n)/(o-n)}return 0},t}();e.Criterion=a;var n=function(e){function t(){e.call(this),this.userWeightMax=5,this.featureIds=[],this.weight=1,this.isPlaUpdated=!1}return __extends(t,e),t.prototype.deserialize=function(t){return this.section=t.section,this.stringFormat=t.stringFormat,this.rankTitle=t.rankTitle,this.rankDescription=t.rankDescription,this.rankFormat=t.rankFormat,this.userWeightMax=t.userWeightMax,this.featureIds=t.featureIds,e.prototype.deserialize.call(this,t),this},t.prototype.update=function(){this.calculateWeights(),this.setColors()},t.prototype.calculateWeights=function(e){e||(e=this.criteria);var t=0;for(var r in e){var i=e[r];i.criteria.length>0&&this.calculateWeights(i.criteria),t+=i.userWeight}if(t>0)for(var a in e){var n=e[a];n.weight=n.userWeight/t}},t.prototype.setColors=function(){var e=chroma.scale("RdYlBu").domain([0,this.criteria.length-1],this.criteria.length),t=0,r=0;this.criteria.forEach(function(i){t+=i.criteria.length,i.color||(i.color=e(r++).hex())});var i=chroma.scale("PRGn").domain([0,t-1],t);r=0,this.criteria.forEach(function(e){e.criteria.forEach(function(e){e.color||(e.color=i(r++).hex())})})},t}(a);e.Mca=n}(e.Models||(e.Models={}));e.Models}(Mca||(Mca={}));var Helpers;!function(e){!function(e){var t="csWeb.resize";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("resize",["$window",function(e){return{terminal:!1,restrict:"A",scope:{resizeX:"@",resizeY:"@"},link:function(t,r){t.onResizeFunction=function(){if(t.resizeX){var i=e.innerWidth;r.width(i-t.resizeX+"px")}if(t.resizeY){var a=e.innerHeight;r.height(a-t.resizeY+"px")}},t.onResizeFunction(),angular.element(e).bind("resize",function(){t.onResizeFunction(),t.$apply()})}}}])}(e.Resize||(e.Resize={}));e.Resize}(Helpers||(Helpers={}));var ShowModal;!function(e){var t="csWeb.showModal";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("showModal",["$parse",function(e){return{restrict:"A",link:function(t,r,i){t.showModalDialog=function(e,t){t||(t=r);var i=$(t);e?i.appendTo("body").modal("show"):i.modal("hide")},t.$watch(i.showModal,function(e){t.showModalDialog(e,i.$$element)}),$(r).bind("hide.bs.modal",function(){e(i.showModal).assign(t,!1),t.$$phase||t.$root.$$phase||t.$apply()})}}}])}(ShowModal||(ShowModal={}));var StyleList;!function(e){e.html='<div>    <h4 class="leftpanel-header" translate="STYLES"></h4>    <div ng-show="vm.$layerService.noStyles" translate="STYLE_INFO"></div>    <div data-ng-repeat="group in vm.$layerService.project.groups" style="margin-left: 5px">        <div ng-show="group.styles.length">            <div style="float:left;margin-left: -10px; margin-top: 5px" data-toggle="collapse" data-target="#stylegroup_{{group.id}}"><i class="fa fa-chevron-down togglebutton toggle-arrow-down"></i><i class="fa fa-chevron-up togglebutton toggle-arrow-up"></i></div>            <div class="group-title">{{group.title}}</div>            <div id="stylegroup_{{group.id}}" class="collapse in">                <div data-ng-repeat="style in group.styles">                    <div class="checkbox checkbox-primary" style="margin-left:20px;float:left">                        <input type="checkbox" id="cbstyle{{style.id}}" ng-model="style.enabled" data-ng-change="vm.$layerService.updateStyle(style);">                        <label class="style-title" for="cbstyle{{style.id}}" style="width:175px">{{style.title}}</label>                    </div>                    <div style="float:right;margin-top:10px; width: 50px">                        <div data-ng-show="style.canSelectColor" style="float:left">                            <div class="dropdown">                                <div class="style-settings" data-toggle="dropdown">                                    <style>                                                                             </style>                                    <!--<img src="includes/images/fillcolor.png" style="width: 32px; height:32px" />-->                                    <div id="colors" style="border-radius: 50%;width: 20px;height:20px;border-style:solid;border-color: black;border-width: 1px;background: linear-gradient(to right, {{style.colors[0]}} , {{style.colors[1]}})">                                                                        </div>                                    <b class="caret"></b>                                </div>                                <!--<a class="btn btn-primary btn-sm" ng-model="style.visualAspect"  style="padding-left: 10px" href="#"> {{ style.visualAspect }} </a>-->                                <ul class="dropdown-menu" role="menu">                                    <li ng-repeat="(key,val) in style.colorScales" style="margin:3px;cursor: pointer">                                        <span ng-click="$parent.style.colors = val;vm.$layerService.updateStyle($parent.style)"> {{key}} </span>                                    </li>                                </ul>                            </div>                        </div>                        <div style="float:right">                            <div class="dropdown">                                <div class="style-settings" data-toggle="dropdown">                                    <!--<img src="includes/images/fillcolor.png" style="width: 32px; height:32px" />-->                                    <div class="style-aspect style-{{style.visualAspect}}"></div><b class="caret"></b>                                </div>                                <!--<a class="btn btn-primary btn-sm" ng-model="style.visualAspect"  style="padding-left: 10px" href="#"> {{ style.visualAspect }} </a>-->                                <ul class="dropdown-menu" role="menu">                                    <li ng-repeat="title in style.availableAspects" style="margin:3px;cursor: pointer">                                        <i class="style-aspect style-{{title}}" style="float:left" /><span ng-click="$parent.style.visualAspect = title;vm.$layerService.updateStyle($parent.style)"><img class="fa fa-search" style="margin-right: 8px" /> {{title}} </span>                                    </li>                                    <li class="divider"></li>                                    <li style="margin:3px;cursor: pointer"><i class="fa fa-remove" style="margin-right: 8px" style=" float:left" /><span ng-click="vm.$layerService.removeStyle(style)">Verwijder</span></li>                                </ul>                            </div>                        </div>                    </div>                </div>                <!--<div style="right:5px; position:absolute; margin-top: -15px"><a href="#" id="stylepop{{style.id}}" rel="popover" popover-template="template.html"><img src="includes/images/settings.png" width="20px"></a></div>-->            </div>        </div>    </div></div>'
}(StyleList||(StyleList={}));var StyleList;!function(e){var t="csWeb.styleList";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("styleList",["$window","$compile",function(t){return{terminal:!1,restrict:"E",scope:{},template:e.html,link:function(e){e.onResizeFunction=function(){var r=50,i=100,a=60;e.numberOfItems=Math.floor((t.innerHeight-r-i)/a)},e.onResizeFunction(),angular.element(t).bind("resize",function(){e.onResizeFunction(),e.$apply()})},replace:!0,transclude:!0,controller:e.StyleListCtrl}}]).directive("bsPopover",function(){return function(e,t){t.find("a[rel=popover]").popover({placement:"right",html:"true"})}})}(StyleList||(StyleList={}));var StyleList;!function(e){var t=function(){function e(e,t){this.$scope=e,this.$layerService=t,e.vm=this}return e.$inject=["$scope","layerService"],e}();e.StyleListCtrl=t}(StyleList||(StyleList={}));var Timeline;!function(e){e.html='<div>    <style>    #timeline {        position:absolute;bottom:0;height:100px;width:100%;background: white    }         .callout.top::before {left: 45%;bottom: -20px;border-top: 10px solid #444;}.callout::before {content: "";width: 0px;height: 0px;border: 0.8em solid transparent;position: absolute;}#focustimeContainer {    width: 150px;    cursor: e-resize;height: 50px;background: #444;right: 200px;bottom: 105px;    color: white;position: absolute;    z-index: 1000;/* float: right; */display: block;}    </style>    <div>        <div id="timelinecontainer">            <div id="timeline"></div>                    </div>        <div class="callout top" id="focustimeContainer">            <div style="text-align: center">                <span style="font-weight: bold">{{vm.focusDate | date:"MM/dd/yyyy"}}</span><br />                <span>{{vm.focusDate | date:"h:mma"}}</span>            </div>        </div>    </div></div>'}(Timeline||(Timeline={}));var Timeline;!function(e){var t="csWeb.timeline";e.myModule;try{e.myModule=angular.module(t)}catch(r){e.myModule=angular.module(t,[])}e.myModule.directive("timeline",["$compile",function(t){return{terminal:!0,restrict:"E",scope:{},template:e.html,compile:function(e){var r=t(e);return function(e){r(e)}},replace:!0,transclude:!0,controller:e.TimelineCtrl}}])}(Timeline||(Timeline={}));var Timeline;!function(e){var t=function(){function e(e,t,r,i){var a=this;this.$scope=e,this.$layerService=t,this.$mapService=r,this.$messageBusService=i,e.vm=this;var n={width:"100%",height:"100px",editable:!1,layout:"box"};e.timeline=new links.Timeline(document.getElementById("timeline"),n),this.$layerService.timeline=e.timeline,e.timeline.draw(),links.events.addListener(e.timeline,"rangechange",_.throttle(function(e){return a.onRangeChanged(e)},200)),$("#focustimeContainer").draggable({axis:"x",containment:"parent",drag:_.throttle(function(){return a.updateFocusTime()},200)}),this.updateFocusTime()}return e.prototype.onRangeChanged=function(){this.updateFocusTime()},e.prototype.updateFocusTime=function(){var e=$("#focustimeContainer").offset().left,t=$("#timelinecontainer").offset().left-15,r=e-t+$("#focustimeContainer").width()/2,i=$("#timeline").width;this.focusDate=new Date(this.$scope.timeline.screenToTime(r)),this.startDate=new Date(this.$scope.timeline.screenToTime(0)),this.endDate=new Date(this.$scope.timeline.screenToTime(i)),null!=this.$layerService.project&&null!=this.$layerService.project.timeLine&&this.$layerService.project.timeLine.setFocus(this.focusDate,this.startDate,this.endDate),this.$messageBusService.publish("timeline","focusChange",this.focusDate)},e.$inject=["$scope","layerService","mapService","messageBusService"],e}();e.TimelineCtrl=t}(Timeline||(Timeline={}));var csComp;!function(e){!function(t){function r(){var e="Microsoft Internet Explorer"===navigator.appName,t=!!navigator.userAgent.match(/Trident\/7\./);return!(e||t)}function i(t,r){var i;if(e.StringExt.isNullOrEmpty(r)||$.isNumeric(r)||(r=r.replace(/&amp;/g,"&")),e.StringExt.isNullOrEmpty(r))return"";switch(t.type){case"bbcode":e.StringExt.isNullOrEmpty(t.stringFormat)||(r=String.format(t.stringFormat,r)),i=XBBCODE.process({text:r}).html;break;case"number":i=$.isNumeric(r)?e.StringExt.isNullOrEmpty(t.stringFormat)?r.toString():String.format(t.stringFormat,parseFloat(r)):r;break;case"rank":var a=r.split(",");if(2!=a.length)return r;i=t.stringFormat?String.format(t.stringFormat,a[0],a[1]):String.format("{0) / {1}",a[0],a[1]);break;default:i=r}return i}function a(){var e=(this.S4()+this.S4()+"-"+this.S4()+"-4"+this.S4().substr(0,3)+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()).toLowerCase();return e}function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}t.supportsDataUri=r,t.convertPropertyInfo=i,t.getGuid=a,t.S4=n}(e.Helpers||(e.Helpers={}));e.Helpers}(csComp||(csComp={}));var csComp;!function(e){!function(e){var t=function(){function e(e,t){this.topic=e,this.callback=t}return e}();e.MessageBusHandle=t;var r=function(){function e(){PNotify.prototype.options.styling="fontawesome"}return e.prototype.notify=function(e,t){{var r={title:e,text:t,icon:"fa fa-info",cornerclass:"ui-pnotify-sharp",addclass:"stack-bottomright",stack:{dir1:"up",dir2:"left",firstpos1:25,firstpos2:25}};new PNotify(r)}},e.prototype.confirm=function(e,t,r){{var i={title:e,text:t,hide:!1,confirm:{confirm:!0},buttons:{closer:!1,sticker:!1},history:{history:!1},icon:"fa fa-question-circle",cornerclass:"ui-pnotify-sharp",addclass:"stack-topright",stack:{dir1:"down",dir2:"left",firstpos1:25,firstpos2:25}};new PNotify(i).get().on("pnotify.confirm",function(){r(!0)}).on("pnotify.cancel",function(){r(!1)})}},e.prototype.notifyBottom=function(){{var e={dir1:"up",dir2:"right",spacing1:0,spacing2:0},t={title:"Over Here",text:"Check me out. I'm in a different stack.",addclass:"stack-bar-bottom",cornerclass:"",width:"70%",stack:e};new PNotify(t)}},e.prototype.notifyData=function(e){new PNotify(e)},e.prototype.publish=function(t,r,i){e.cache[t]&&e.cache[t].forEach(function(e){return e(r,i)})},e.prototype.subscribe=function(r,i){return e.cache[r]||(e.cache[r]=new Array),e.cache[r].push(i),new t(r,i)},e.prototype.unsubscribe=function(t){var r=t.topic,i=t.callback;e.cache[r]&&e.cache[r].forEach(function(t,a){return t==i?void e.cache[r].splice(a,1):void 0})},e.cache={},e}();e.MessageBusService=r;var i=function(){function e(){}return e.prototype.bind=function(e,t){this.myEvents=this.myEvents||{},this.myEvents[e]=this.myEvents[e]||[],this.myEvents[e].push(t)},e.prototype.unbind=function(e,t){this.myEvents=this.myEvents||{},e in this.myEvents!=!1&&this.myEvents[e].splice(this.myEvents[e].indexOf(t),1)},e.prototype.unbindEvent=function(e){this.myEvents=this.myEvents||{},this.myEvents[e]=[]},e.prototype.unbindAll=function(){this.myEvents=this.myEvents||{};for(var e in this.myEvents)this.myEvents[e]=!1},e.prototype.trigger=function(e){for(var t=[],r=0;r<arguments.length-1;r++)t[r]=arguments[r+1];if(this.myEvents=this.myEvents||{},e in this.myEvents!=!1)for(var i=0;i<this.myEvents[e].length;i++)this.myEvents[e][i].apply(this,Array.prototype.slice.call(arguments,1))},e.prototype.registerEvent=function(e){this[e]=function(t,r){return"function"==typeof t&&(r&&this.unbindEvent(e),this.bind(e,t)),this}},e.prototype.registerEvents=function(e){var t=this;e.forEach(function(e){t.registerEvent(e)})},e}();e.EventObj=i}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var csComp;!function(e){!function(e){var t=function(){function e(){}return e}();e.PieData=t;var r=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(t);e.AsterPieData=r;var i=function(){function e(){}return e.drawPie=function(t,r,i,a,n){if("undefined"==typeof i&&(i="mcaPieChart"),"undefined"==typeof a&&(a="Reds"),"undefined"==typeof n&&(n="the_SVG_ID"),e.clearSvg(n),r){var o=t,s=t,l=Math.min(o,s)/2,c=0,p=d3.layout.pie().sort(null).value(function(e){return e.weight}),u=d3.tip().attr("class","d3-tip").offset([0,0]).html(function(e){return"<strong>"+e.data.label+": </strong><span style='color:orangered'>"+Math.round(100*e.data.weight)+"%</span>"}),d=d3.svg.arc().innerRadius(c).outerRadius(l),h=d3.svg.arc().innerRadius(c).outerRadius(l),f=d3.select("#"+i).append("svg").attr("id",n).attr("width",o).attr("height",s).append("g").attr("transform","translate("+o/2+","+s/2+")");f.call(u);{var m=chroma.scale(a).domain([0,r.length-1],r.length);f.selectAll(".solidArc").data(p(r)).enter().append("path").attr("fill",function(e,t){return e.data.color||m(t).hex()}).attr("class","solidArc").attr("stroke","gray").attr("d",d).on("mouseover",function(e,t){u.show(e,t)}).on("mouseout",u.hide),f.selectAll(".outlineArc").data(p(r)).enter().append("path").attr("fill","none").attr("stroke","gray").attr("class","outlineArc").attr("d",h)}}},e.drawAsterPlot=function(t,r,i,a,n){if("undefined"==typeof i&&(i="mcaPieChart"),"undefined"==typeof a&&(a="Reds"),"undefined"==typeof n&&(n="the_SVG_ID"),e.clearSvg(n),r){var o=t,s=t,l=Math.min(o,s)/2,c=.3*l,p=d3.layout.pie().sort(null).value(function(e){return e.weight}),u=d3.tip().attr("class","d3-tip").offset([0,0]).html(function(e){return"<strong>"+e.data.label+": </strong> <span style='color:orangered'>"+Math.round(100*e.data.weight)+"% x "+Math.round(e.data.score)+"&nbsp; = "+Math.round(e.data.weight*e.data.score)+"</span>"}),d=d3.svg.arc().innerRadius(c).outerRadius(function(e){return(l-c)*(e.data.score/100)+c}),h=d3.svg.arc().innerRadius(c).outerRadius(l),f=d3.select("#"+i).append("svg").attr("id",n).attr("width",o).attr("height",s).append("g").attr("transform","translate("+o/2+","+s/2+")");try{f.call(u)}catch(m){console.log("Error: "+m.message)}var y=chroma.scale(a).domain([0,r.length-1],r.length),v=(f.selectAll(".solidArc").data(p(r)).enter().append("path").attr("fill",function(e,t){return e.data.color||y(t).hex()}).attr("class","solidArc").attr("stroke","gray").attr("d",d).on("mouseover",function(e,t){u.show(e,t)}).on("mouseout",u.hide),f.selectAll(".outlineArc").data(p(r)).enter().append("path").attr("fill","none").attr("stroke","gray").attr("class","outlineArc").attr("d",h),0),g=0;r.forEach(function(e){v+=e.weight,g+=e.weight*e.score}),f.append("svg:text").attr("class","aster-score").attr("dy",".35em").attr("text-anchor","middle").text(Math.round(g/v))}},e.clearSvg=function(e){var t=d3.select("#"+e);t&&t.remove()},e.pieColors=["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],e}();e.Plot=i}(e.Helpers||(e.Helpers={}));e.Helpers}(csComp||(csComp={}));var csComp;!function(e){!function(e){function t(e){return!e}function r(e){for(var t=[],r=0;r<arguments.length-1;r++)t[r]=arguments[r+1];for(var i=t.length;i--;)e=e.replace(new RegExp("\\{"+i+"\\}","gm"),t[i]);return e}function i(e){return!isNaN(parseFloat(e))&&isFinite(e)}function a(e){return"true"===e||"false"===e}function n(e){return!1}e.isNullOrEmpty=t,e.format=r,e.isNumber=i,e.isBoolean=a,e.isBbcode=n}(e.StringExt||(e.StringExt={}));e.StringExt}(csComp||(csComp={}));var csComp;!function(e){!function(t){"use strict";var r=function(){function r(e,t,r,i){var a=this;this.$location=e,this.$translate=t,this.$messageBusService=r,this.$mapService=i,this.layerGroup=new L.LayerGroup,this.info=new L.Control,this.mb=r,this.map=i,this.accentColor="",this.title="",this.layerGroup=new L.LayerGroup,this.featureTypes={},this.propertyTypeData={},this.map.map.addLayer(this.layerGroup),this.noStyles=!0,this.$messageBusService.subscribe("timeline",function(e){switch(e){case"focusChange":a.updateSensorData()}})}return r.prototype.updateSensorData=function(){var e=this;if(null!=this.project&&null!=this.project.timeLine){var t=this.project.timeLine.focus,r={};this.project.features.forEach(function(i){var a=e.findLayer(i.layerId);if(null!=a){if(!r.hasOwnProperty(i.layerId))for(var n=1;n<a.timestamps.length;n++)if(a.timestamps[n]>t){r[i.layerId]=n;break}if(null!=i.sensors){for(var o in i.sensors){var s=i.sensors[o],l=s[r[i.layerId]];i.properties[o]=l}e.updateFeatureIcon(i,a)}}}),this.$messageBusService.publish("feature","onFeatureUpdated")}},r.prototype.addLayer=function(t){var r=this,i=[];switch(t.type){case"GeoJson":async.series([function(e){t.group.oneLayerActive&&t.group.layers.forEach(function(e){e!=t&&e.enabled&&i.push(e)}),e(null,null)},function(e){t.styleurl?d3.json(t.styleurl,function(i,a){if(i)r.$messageBusService.notify("ERROR loading"+t.title,i);else if(a.featureTypes)for(var n in a.featureTypes){var o=a.featureTypes[n];n=t.id+"_"+n,r.featureTypes[n]=o}e(null,null)}):e(null,null)},function(i){d3.json(t.url,function(a,n){if(a)r.$messageBusService.notify("ERROR loading"+t.title,a);else{if(n.events&&r.timeline){t.events=n.events;var o=[];t.events.forEach(function(t){t.id||(t.id=e.Helpers.getGuid()),o.push({start:new Date(t.start),content:t.title})}),r.timeline.draw(o)}for(var s in n.featureTypes){var l=n.featureTypes[s];s=t.id+"_"+s,r.featureTypes[s]=l;var c='{".style'+s+'":';null!=l.style.iconUri&&(c+=' { "background": "url('+l.style.iconUri+') no-repeat right center",'),c+=' "background-size": "100% 100%","border-style": "none"} }';var p=$.parseJSON(c);$.injectCSS(p)}if(n.timestamps&&(t.timestamps=n.timestamps),t.group.clustering){var u=L.geoJson(n,{pointToLayer:function(e,i){return r.addFeature(e,i,t)},onEachFeature:function(e,i){t.group.markers[e.id]=i,i.on({mouseover:function(e){return r.showFeatureTooltip(e,t.group)},mouseout:function(e){return r.hideFeatureTooltip(e)}})}});t.group.cluster.addLayer(u)}else{t.mapLayer=new L.LayerGroup,r.map.map.addLayer(t.mapLayer);var d=L.geoJson(n,{onEachFeature:function(e,i){t.group.markers[e.id]=i,i.on({mouseover:function(e){return r.showFeatureTooltip(e,t.group)},mouseout:function(e){return r.hideFeatureTooltip(e)},mousemove:function(e){return r.updateFeatureTooltip(e)},click:function(){r.selectFeature(e)}})},style:function(e,i){return r.initFeature(e,t),t.group.markers[e.id]=i,r.style(e,t)},pointToLayer:function(e,i){return r.addFeature(e,i,t)}});r.project.features.forEach(function(e){if(e.layerId==t.id){var i=r.getFeatureType(e);e.properties.Name=e.properties[i.style.nameLabel]}}),t.mapLayer.addLayer(d)}}r.$messageBusService.publish("layer","activated",t),i(null,null),r.updateFilters()})},function(){i.forEach(function(e){r.removeLayer(e),e.enabled=!1})}])}},r.prototype.filterProperties=function(e){var t=[];return null!=e.filters&&e.filters.length>0&&e.filters.forEach(function(e){t.push(e.property)}),t},r.prototype.showFeatureTooltip=function(t,r){var i=t.target,a=i.feature,n=i.feature.properties.Name,o=n.length,s="<td colspan='3'>"+n+"</td></tr>";null!=r.filters&&r.filters.length>0&&r.filters.forEach(function(t){if(a.properties.hasOwnProperty(t.property)){var r=a.properties[t.property],i=r.toString().length;null!=t.meta&&(r=e.Helpers.convertPropertyInfo(t.meta,r),"bbcode"!=t.meta.type&&(i=r.toString().length)),o=Math.max(o,i+t.title.length),s+="<tr><td><div class='smallFilterIcon'></td><td>"+t.title+"</td><td>"+r+"</td></tr>"}}),null!=r.styles&&r.styles.length>0&&r.styles.forEach(function(t){if(null!=r.filters&&0==r.filters.filter(function(e){return e.property==t.property}).length&&a.properties.hasOwnProperty(t.property)){var i=a.properties[t.property],n=i.toString().length;null!=t.meta&&(i=e.Helpers.convertPropertyInfo(t.meta,i),"bbcode"!=t.meta.type&&(n=i.toString().length)),o=Math.max(o,n+t.title.length),s+="<tr><td><div class='smallStyleIcon'></td><td>"+t.title+"</td><td>"+i+"</td></tr>"}});var l=Math.min(7*o+15,250);s="<table style='width:"+l+"px;'>"+s+"</table>",this.popup=L.popup({offset:new L.Point(-l/2-40,-5),closeOnClick:!0,autoPan:!1,className:"featureTooltip"}).setLatLng(t.latlng).setContent(s).openOn(this.map.map)},r.prototype.hideFeatureTooltip=function(){this.popup&&this.map.map&&(this.map.map.closePopup(this.popup),this.popup=null)},r.prototype.updateFeatureTooltip=function(e){null!=this.popup&&null!=e.latlng&&this.popup.setLatLng(e.latlng)},r.prototype.highlightFeature=function(e){var t={weight:7},r=e.target;r.bindPopup(r.feature.properties.Name).openPopup(),L.Browser.ie||r.bringToFront(),r.setStyle(t),L.Browser.ie||r.bringToFront()},r.prototype.resetHighlight=function(e){var t={weight:1},r=e.target;r.setStyle(t)},r.prototype.removeStyle=function(e){var t=e.group;t.styles=t.styles.filter(function(t){return t.id!=e.id}),this.updateGroupFeatures(t)},r.prototype.updateStyle=function(e){null!=e&&null!=e.group&&(e.info=this.calculatePropertyInfo(e.group,e.property),e.canSelectColor=e.visualAspect.toLowerCase().indexOf("color")>-1,this.updateGroupFeatures(e.group))},r.prototype.updateFeature=function(e,t){if("Point"==e.geometry.type){var r=this.findLayer(e.layerId);null!=r&&this.updateFeatureIcon(e,r)}else{if(null==t){var i=this.findLayer(e.layerId);t=i.group}if(null==t)return;var a=t.markers[e.id];this.updatePolygonStyle(a,e)}},r.prototype.updateGroupFeatures=function(e){var t=this;this.project.features.forEach(function(r){e.markers.hasOwnProperty(r.id)&&t.updateFeature(r,e)})},r.prototype.getDefaultMarkerStyle=function(){},r.prototype.updatePolygonStyle=function(e,t){var r=this.findLayer(t.layerId),i=this.style(t,r);e.setStyle(i)},r.prototype.getColor=function(e,t){if(e>t.info.sdMax)return t.colors[t.colors.length-1];if(e<t.info.sdMin)return t.colors[0];var r=chroma.interpolate.bezier(t.colors),i=r((e-t.info.sdMin)/(t.info.sdMax-t.info.sdMin)).hex();return i},r.prototype.style=function(e,t){var r=this,i={fillColor:"red",weight:2,opacity:1,color:"black",fillOpacity:.7},a=this.getFeatureType(e);return a.style&&(null!=a.style.fillColor&&(i.fillColor=a.style.fillColor),null!=a.style.strokeColor&&(i.strokeColor=a.style.strokeColor),null!=a.style.strokeWidth&&(i.weight=a.style.strokeWidth)),t.group.styles.forEach(function(t){if(t.enabled&&e.properties.hasOwnProperty(t.property)){var a=Number(e.properties[t.property]);switch(t.visualAspect){case"strokeColor":i.color=r.getColor(a,t);break;case"fillColor":i[t.visualAspect]=r.getColor(a,t);break;case"strokeWidth":i.weight=(a-t.info.sdMin)/(t.info.sdMax-t.info.sdMin)*10+1}}}),e.isSelected&&(i.weight=7,i.color="blue"),i},r.prototype.initFeature=function(t,r){return t.isInitialized=!0,null==t.id&&(t.id=e.Helpers.getGuid()),t.layerId=r.id,this.project.features.push(t),r.group.ndx.add([t]),t.fType=this.getFeatureType(t),t.type},r.prototype.removeFeature=function(){},r.prototype.getPointIcon=function(e,t){var r;if(null!=e.htmlStyle)r=new L.DivIcon({className:"",iconSize:new L.Point(32,32),html:e.htmlStyle});else{var i="<div ",a={},n=this.getFeatureType(e);null==n.style.fillColor&&null==n.style.iconUri&&(n.style.fillColor="lightgray"),a.background=n.style.fillColor,a.width="32px",a.height="32px",a["border-radius"]="20%",a["border-style"]="solid",a["border-color"]="black",a["border-width"]="0",t.group.styles.forEach(function(t){if(t.enabled&&e.properties.hasOwnProperty(t.property)){var r=e.properties[t.property];switch(t.visualAspect){case"fillColor":if("color"==t.meta.type)a["background-color"]=r;else{var i=chroma.interpolate.bezier(t.colors);a["background-color"]=i((r-t.info.sdMin)/(t.info.sdMax-t.info.sdMin)).hex()}}}}),e.isSelected&&(a["border-width"]="3px"),i+=" style='display: inline-block;vertical-align: middle;text-align: center;";for(var o in a)i+=o+":"+a[o]+";";i+="'>",null!=n.style.iconUri&&(i+="<img src="+n.style.iconUri+" style='width:"+(n.style.iconWidth-2)+"px;height:"+(n.style.iconHeight-2)+"px' />"),i+="</div>",r=new L.DivIcon({className:"",iconSize:new L.Point(n.style.iconWidth,n.style.iconHeight),html:i})}return r},r.prototype.updateFeatureIcon=function(e,t){var r=t.group.markers[e.id];null!=r&&r.setIcon(this.getPointIcon(e,t))},r.prototype.addFeature=function(e,t,r){{var i,a=this,n=this.initFeature(e,r);n.style}switch(e.geometry.type){case"Point":var o=this.getPointIcon(e,r);i=new L.Marker(t,{icon:o}),i.on("click",function(){a.selectFeature(e)});break;default:var s={fillColor:"Green"};i=L.multiPolygon(t,s)}return r.group.markers[e.id]=i,i},r.prototype.selectFeature=function(e){e.isSelected=!e.isSelected,this.updateFeature(e),null!=this.lastSelectedFeature&&this.lastSelectedFeature!=e&&(this.lastSelectedFeature.isSelected=!1,this.updateFeature(this.lastSelectedFeature)),this.lastSelectedFeature=e,e.isSelected?(this.$messageBusService.publish("sidebar","show"),this.$messageBusService.publish("feature","onFeatureSelect",e)):(this.$messageBusService.publish("sidebar","hide"),this.$messageBusService.publish("feature","onFeatureDeselect"))},r.prototype.findFilter=function(e,t){null==e.filters&&(e.filters=[]);var r=e.filters.filter(function(e){return e.property==t});return r.length>0?r[0]:null},r.prototype.findLayer=function(e){var t;return this.project.groups.forEach(function(r){r.layers.forEach(function(r){r.id==e&&(t=r)})}),t},r.prototype.setStyle=function(r,i){var a=this;"undefined"==typeof i&&(i=!0);var n=r.feature;if(null!=n){this.noStyles=!1;var o=this.findLayer(n.layerId),s=new t.GroupStyle(this.$translate);s.id=e.Helpers.getGuid(),s.title=r.key,s.meta=r.meta,s.visualAspect="fillColor",s.canSelectColor=s.visualAspect.toLowerCase().indexOf("color")>-1,s.property=r.property,null==s.info&&(s.info=this.calculatePropertyInfo(o.group,r.property)),s.enabled=!0,s.group=o.group,s.meta=r.meta;var l=this.getFeatureType(n);return s.colors=l.style&&l.style.fillColor?["white","orange"]:["white","orange"],this.saveStyle(o.group,s),"point"==n.geometry.type.toLowerCase()?this.project.features.forEach(function(e){o.group.markers.hasOwnProperty(e.id)&&a.updateFeatureIcon(e,o)}):this.updateStyle(s),i&&$('#leftPanelTab a[href="#styles"]').tab("show"),s}},r.prototype.saveStyle=function(e,t){var r=e.styles.filter(function(e){return e.visualAspect==t.visualAspect});if(r.length>0){var i=e.styles.indexOf(r[0]);e.styles.splice(i,1)}e.styles.push(t)},r.prototype.addFilter=function(e,r){var i=this.findFilter(e,r);if(null==i){var a=new t.GroupFilter;a.property=r,a.title=r,a.rangex=[0,1],e.filters.push(a)}else{var n=e.filters.indexOf(i);-1!=n&&e.filters.slice(n,1)}this.updateFilters(),$('#leftPanelTab a[href="#filters"]').tab("show")},r.prototype.setFilter=function(e){var r=e.property,i=e.feature;if(null!=i){var a=this.findLayer(i.layerId);if(null!=a){var n=this.findFilter(a.group,r);if(null==n){var o=new t.GroupFilter;if(o.property=r,o.meta=e.meta,o.filterType="bar",null!=o.meta)if(null!=o.meta.filterType)o.filterType=o.meta.filterType;else switch(o.meta.type){case"number":o.filterType="bar";break;default:o.filterType="text",o.stringValue=e.value,o.value=e.value}if(o.title=e.key,o.rangex=[0,1],"text"==o.filterType){var s=a.group.filters.filter(function(e){return"text"==e.filterType});s.forEach(function(e){e.dimension.filterAll(),e.dimension.dispose()}),a.group.filters=a.group.filters.filter(function(e){return"text"!=e.filterType})}a.group.filters.push(o)}else{var l=a.group.filters.indexOf(n);-1!=l&&a.group.filters.slice(l,1)}}this.updateFilters(),$('#leftPanelTab a[href="#filters"]').tab("show")}},r.prototype.getFeatureType=function(e){var t=e.properties.FeatureTypeId||"Default",r=e.layerId+"_"+t;return this.featureTypes.hasOwnProperty(r)||(this.featureTypes.hasOwnProperty(t)?r=t:this.featureTypes[r]=this.createDefaultType(e)),e.featureTypeName=r,this.featureTypes[r]},r.prototype.createDefaultType=function(t){var r={};r.style={nameLabel:"Name"},r.propertyTypeData=[];for(var i in t.properties){var a=[];a.label=i,a.title=i.replace("_"," "),a.isSearchable=!0,a.visibleInCallOut=!0,a.canEdit=!1;var n=t.properties[i];a.type=e.StringExt.isNumber(n)?"number":e.StringExt.isBoolean(n)?"boolean":e.StringExt.isBbcode(n)?"bbcode":"text",r.propertyTypeData.push(a)}return r},r.prototype.resetFilters=function(){dc.filterAll(),dc.redrawAll()},r.prototype.getGroupFeatures=function(e){var t=[];e.layers.forEach(function(e){e.enabled&&t.push(e.id)});var r=this.project.features.filter(function(e){return t.indexOf(e.layerId)>-1});return r},r.prototype.rebuildFilters=function(e){e.ndx=crossfilter([]);var t=this.getGroupFeatures(e);e.ndx.add(t),this.updateFilters()},r.prototype.removeLayer=function(e){this.$messageBusService.publish("layer","deactivate",e);var t,r=e.group;null!=this.lastSelectedFeature&&this.lastSelectedFeature.layerId==e.id&&(this.lastSelectedFeature=null,this.$messageBusService.publish("sidebar","hide"),this.$messageBusService.publish("feature","onFeatureDeselect")),r.clustering?(t=r.cluster,this.project.features.forEach(function(r){if(r.layerId==e.id)try{t.removeLayer(e.group.markers[r.id]),delete e.group.markers[r.id]}catch(i){}})):this.map.map.removeLayer(e.mapLayer),this.project.features=this.project.features.filter(function(t){return t.layerId!=e.id});var i=e.id+"_";for(var a in this.featureTypes)0===a.lastIndexOf(i,0)&&delete this.featureTypes[a];0==r.layers.filter(function(e){return e.enabled}).length&&(r.filters.forEach(function(e){null!=e.dimension&&e.dimension.dispose()}),r.filters=[],r.styles=[]),this.rebuildFilters(r)},r.prototype.openSolution=function(e,t,r){var i=this;$.getJSON(e,function(e){if(e.maxBounds&&(i.maxBounds=e.maxBounds,i.$mapService.map.setMaxBounds(new L.LatLngBounds(e.maxBounds.southWest,e.maxBounds.northEast))),e.viewBounds&&i.$mapService.map.fitBounds(new L.LatLngBounds(e.viewBounds.southWest,e.viewBounds.northEast)),e.baselayers.forEach(function(e){var t={};t.subtitle=e.subtitle,t.preview=e.preview,null!=e.subdomains&&(t.subdomains=e.subdomains),null!=e.maxZoom&&(t.maxZoom=e.maxZoom),null!=e.minZoom&&(t.minZoom=e.minZoom),null!=e.attribution&&(t.attribution=e.attribution),null!=e.id&&(t.id=e.id);var r=L.tileLayer(e.url,t);i.$mapService.baseLayers[e.title]=r,e.isDefault&&i.$mapService.changeBaseLayer(r)}),e.projects.length>0){var a=e.projects.filter(function(e){return e.title==r})[0];null!=a?i.openProject(a.url,t):i.openProject(e.projects[0].url,t)}i.solution=e})},r.prototype.openProject=function(r,i){var a,n=this;a=[],i&&i.split(";").forEach(function(e){a.push(e.toLowerCase())}),this.layerGroup.clearLayers(),this.featureTypes={},$.getJSON(r,function(r){if(n.project=r,n.project.timeLine||(n.project.timeLine=new t.DateRange),n.project.viewBounds&&n.$mapService.map.fitBounds(new L.LatLngBounds(n.project.viewBounds.southWest,n.project.viewBounds.northEast)),n.project.featureTypes)for(var i in n.project.featureTypes){var o=n.project.featureTypes[i];n.featureTypes[i]=o}if(n.project.propertyTypeData)for(var s in n.project.propertyTypeData){var l=n.project.propertyTypeData[s];n.propertyTypeData[s]=l}if(!n.project.dashboards){n.project.dashboards={};var c=new e.Services.Dashboard("1",n.project.title);c.widgets=[],n.project.dashboards[n.project.title]=c}n.project.dataSets||(n.project.dataSets=[]),n.project.features=[],n.project.groups.forEach(function(t){null==t.id&&(t.id=e.Helpers.getGuid()),t.ndx=crossfilter([]),null==t.styles&&(t.styles=[]),null==t.filters&&(t.filters=[]),t.markers={},t.clustering?(t.cluster=new L.MarkerClusterGroup({maxClusterRadius:t.maxClusterRadius||80,disableClusteringAtZoom:t.clusterLevel||0}),n.map.map.addLayer(t.cluster)):(t.vectors=new L.LayerGroup,n.map.map.addLayer(t.vectors)),t.layers.forEach(function(r){null==r.reference&&(r.reference=e.Helpers.getGuid()),r.group=t,(r.enabled||a.indexOf(r.reference.toLowerCase())>=0)&&(r.enabled=!0,n.addLayer(r))}),t.styles.forEach(function(t){null!=t.id&&(t.id=e.Helpers.getGuid())}),t.filters.forEach(function(t){null!=t.id&&(t.id=e.Helpers.getGuid())}),r.startposition&&n.$mapService.zoomToLocation(new L.LatLng(r.startposition.latitude,r.startposition.longitude)),n.updateFilters()}),n.$messageBusService.publish("project","loaded")})},r.prototype.zoom=function(){},r.prototype.calculatePropertyInfo=function(e,r){var i=this,a=new t.PropertyInfo;a.count=0;var n=0,o=0;if(e.layers.forEach(function(e){e.enabled&&i.project.features.forEach(function(t){if(t.layerId==e.id&&t.properties.hasOwnProperty(r)){var i=t.properties[r],s=Number(i);0/0!=s&&(a.count+=1,n+=s,o+=s*s,(null==a.max||s>a.max)&&(a.max=s),(null==a.min||s<a.min)&&(a.min=s))}})}),a.mean=n/a.count,a.varience=o/a.count-a.mean*a.mean,a.sd=Math.sqrt(a.varience),a.sdMax=a.mean+3*a.sd,a.sdMin=a.mean-3*a.sd,a.min>a.sdMin&&(a.sdMin=a.min),a.max<a.sdMax&&(a.sdMax=a.max),0/0==a.sdMin&&(a.sdMin=a.min),0/0==a.sdMax&&(a.sdMax=a.max),this.propertyTypeData.hasOwnProperty(r)){var s=this.propertyTypeData[r];null!=s.maxValue&&(a.sdMax=s.maxValue),null!=s.minValue&&(a.sdMin=s.minValue)}return a},r.prototype.updateFilters=function(){var e=this,t=$("#filterChart");t.empty(),this.noFilters=!0,this.project.groups.forEach(function(t){null!=t.filters&&t.filters.length>0&&($("<div style='float:left;margin-left: -10px; margin-top: 5px' data-toggle='collapse' data-target='#filters_"+t.id+"'><i class='fa fa-chevron-down togglebutton toggle-arrow-down'></i><i class='fa fa-chevron-up togglebutton toggle-arrow-up'></i></div><div class='group-title' >"+t.title+"</div><div id='filtergroupcount_"+t.id+"'  class='filter-group-count' /><div class='collapse in' id='filters_"+t.id+"'></div>").appendTo("#filterChart"),t.filters.forEach(function(r){switch(null!=r.dimension&&r.dimension.dispose(),e.noFilters=!1,r.filterType){case"text":e.addTextFilter(t,r);break;case"bar":e.addBarFilter(t,r)}})),e.updateFilterGroupCount(t)}),dc.renderAll()},r.prototype.updateTextFilter=function(e,t,r){null==r||""==r?t.filterAll():t.filterFunction(function(e){return null!=e?e.toLowerCase().indexOf(r.toLowerCase())>-1:!1}),e.filterResult=t.top(1/0),this.updateMapFilter(e),dc.renderAll()},r.prototype.updateFilterGroupCount=function(e){null!=e.filterResult&&$("#filtergroupcount_"+e.id).text(e.filterResult.length+" objecten geselecteerd")},r.prototype.addTextFilter=function(t,r){var i=this;r.id=e.Helpers.getGuid();var a=("filter_"+r.id,t.ndx.dimension(function(e){return e.properties.hasOwnProperty(r.property)?e.properties[r.property]:null}));r.dimension=a,a.filterFunction(function(e){return null!=e?e.toLowerCase().indexOf(r.stringValue.toLowerCase())>-1:!1}),this.updateTextFilter(t,a,r.stringValue);var n="filtertext"+r.id;$("<h4>"+r.title+"</h4><input type='text' value='"+r.stringValue+"' class='filter-text' id='"+n+"'/><a class='btn' value="+r.value+" id='remove"+r.id+"'><i class='fa fa-times'></i></a>").appendTo("#filters_"+t.id),$("#"+n).keyup(function(){r.stringValue=$("#"+n).val(),i.updateTextFilter(t,a,r.stringValue),i.updateFilterGroupCount(t)}),$("#remove"+r.id).on("click",function(){var e=t.filters.indexOf(r);r.dimension.filterAll(),r.dimension.dispose(),r.dimension=null,-1!=e&&(t.filters=t.filters.slice(e-1,e)),dc.filterAll(),i.updateFilters(),i.resetMapFilter(t)})},r.prototype.updateChartRange=function(e,t){var r=$("#fsfrom_"+t.id),i=$("#fsto_"+t.id),a=e.brush().extent();null!=a&&2==a.length?a[0]!=a[1]&&(console.log(a),r.val(a[0]),i.val(a[1])):(r.val("0"),i.val("1"))},r.prototype.addBarFilter=function(t,r){var i=this;r.id=e.Helpers.getGuid();var a=this.calculatePropertyInfo(t,r.property),n="filter_"+r.id;$("<h4>"+r.title+"</h4><div id='"+n+"'></div><div style='display:none' id='fdrange_"+r.id+"'>from <span id='fsfrom_"+r.id+"'/> to <span id='fsto_"+r.id+"'/></div><a class='btn' id='remove"+r.id+"'>remove</a>").appendTo("#filterChart");var o=$("#fsfrom_"+r.id),s=$("#fsto_"+r.id),l=$("#fdrange_"+r.id);$("#remove"+r.id).on("click",function(){var e=t.filters.indexOf(r);-1!=e&&t.filters.splice(e,1),r.dimension.dispose(),i.updateFilters(),i.resetMapFilter(t)});var c=dc.barChart("#"+n),p=20,u=(a.sdMax-a.sdMin)/p,d=t.ndx.dimension(function(e){if(!e.properties.hasOwnProperty(r.property))return null;if(null!=e.properties[r.property]){var t=parseInt(e.properties[r.property]);return t>=a.sdMin&&t<=a.sdMax?Math.floor(t/u)*u:null}});r.dimension=d;{var h=d.group();c.width(275).height(90).dimension(d).group(h).transitionDuration(100).centerBar(!0).gap(5).elasticY(!0).x(d3.scale.linear().domain([a.sdMin,a.sdMax]).range([-1,p+1])).filterPrinter(function(e){var t="";if(e.length>0){var r=e[0];o.text(r[0].toFixed(2)),s.text(r[1].toFixed(2)),t+=r[0]}return t}).on("filtered",function(e){var r=e.hasFilter();r?l.show():l.hide(),dc.events.trigger(function(){t.filterResult=d.top(1/0),i.updateFilterGroupCount(t),i.updateMapFilter(t)
})})}c.xUnits(function(){return 13}),o.on("change",function(){if($.isNumeric(o.val())){var e=parseInt(o.val()),t=c.filters();t.length>0&&(t[0][0]=e,c.filter(t[0]),c.render(),dc.redrawAll())}}),s.on("change",function(){if($.isNumeric(s.val())){var e=parseInt(s.val()),t=c.filters();t.length>0&&(t[0][1]=e,c.filter(t[0]),d.filter(t[0]),dc.renderAll())}}),c.yAxis().ticks(5),c.xAxis().ticks(5),this.updateChartRange(c,r)},r.prototype.updateMapFilter=function(e){$.each(e.markers,function(t,r){var i=e.filterResult.filter(function(e){return e.id==t}).length>0;if(e.clustering){var a=e.cluster.hasLayer(r);!i&&a&&e.cluster.removeLayer(r),i&&!a&&e.cluster.addLayer(r)}else{var n=e.vectors.hasLayer(r);!i&&n&&e.vectors.removeLayer(r),i&&!n&&e.vectors.addLayer(r)}})},r.prototype.resetMapFilter=function(e){$.each(e.markers,function(t,r){if(e.clustering){var i=e.cluster.hasLayer(r);i||e.cluster.addLayer(r)}else{var a=e.vectors.hasLayer(r);a||e.vectors.addLayer(r)}})},r.$inject=["$location","$translate","messageBusService","mapService"],r}();t.LayerService=r}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var csComp;!function(e){!function(e){var t=function(){function e(e,t,r){this.$scope=e,this.$location=t,this.$mapService=r,e.vm=this,this.$mapService.baseLayers={};var i=e.map=r.getMap();i.invalidateSize(),L.control.zoom({position:"bottomright"}).addTo(i),L.control.locate({position:"bottomright",drawCircle:!0,follow:!0,setView:!0,keepCurrentZoomLevel:!0,markerStyle:{weight:1,opacity:.8,fillOpacity:.8},circleStyle:{weight:1,clickable:!1},icon:"icon-direction",metric:!0,strings:{title:"My location",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:18,watch:!0,enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}}).addTo(i)}return e.$inject=["$scope","$location","mapService"],e}();e.MapCtrl=t}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var csComp;!function(e){!function(e){"use strict";var t=function(){function e(e){this.$messageBusService=e,this.baseLayers={},this.initMap()}return e.prototype.initMap=function(){this.map=L.map("map",{zoomControl:!1,attributionControl:!0})},e.prototype.changeBaseLayer=function(e){this.map.addLayer(e),this.activeBaseLayer&&this.map.removeLayer(this.activeBaseLayer),this.map.setZoom(this.map.getZoom()),this.map.fire("baselayerchange",{layer:e}),this.activeBaseLayer=e},e.prototype.invalidate=function(){this.map.invalidateSize()},e.prototype.zoomToLocation=function(e,t){this.map.setView(e,t||14)},e.prototype.zoomTo=function(e){var t,r=this;if("POINT"==e.geometry.type.toUpperCase())t=new L.LatLng(e.geometry.coordinates[1],e.geometry.coordinates[0]),this.map.setView(t,14);else{var i;e.geometry.type.toUpperCase().indexOf("MULTI")<0?i=this.getBoundingBox(e.geometry.coordinates[0]):(i=[1e3,-1e3,1e3,-1e3],e.geometry.coordinates.forEach(function(e){var t=r.getBoundingBox(e[0]);i=[Math.min(i[0],t[0]),Math.max(i[1],t[1]),Math.min(i[2],t[2]),Math.max(i[3],t[3])]}));var a=.05,n=L.latLng(Math.min(i[2],i[3]),Math.min(i[0],i[1])-a),o=L.latLng(Math.max(i[2],i[3]),Math.max(i[0],i[1])+a);this.map.fitBounds(new L.LatLngBounds(n,o))}this.$messageBusService.publish("sidebar","show"),this.$messageBusService.publish("feature","onFeatureSelect",e)},e.prototype.getBoundingBox=function(e){return e.reduce(function(e,t){return[Math.min(e[0],t[0]),Math.max(e[1],t[0]),Math.min(e[2],t[1]),Math.max(e[3],t[1])]},[1e3,-1e3,1e3,-1e3])},e.prototype.getMap=function(){return this.map},e.$inject=["messageBusService"],e}();e.MapService=t}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var csComp;!function(e){!function(e){var t=function(){function e(e,t){this.$scope=e,this.$mapService=t,e.vm=this,e.location=new L.LatLng(0,0)}return e.prototype.doSearch=function(){if(0===this.$scope.location.lat&&0===this.$scope.location.lng)alert("Directive did not update the location property in parent controller.");else{var e=new L.LatLng(this.$scope.location.lat,this.$scope.location.lng);this.$mapService.zoomToLocation(e)}},e.$inject=["$scope","mapService"],e}();e.SearchFormCtrl=t}(e.Search||(e.Search={}));e.Search}(csComp||(csComp={}));var csComp;!function(e){!function(e){"use strict";var t=function(){function e(e){this.$messageBusService=e,this.baseLayers={}}return e.$inject=["messageBusService"],e}();e.TimeService=t}(e.Services||(e.Services={}));e.Services}(csComp||(csComp={}));var Translations;!function(e){var t=function(){function e(){}return e.locale={CANCEL_BTN:"Cancel",OK_BTN:"OK",MAP:"Maps",MAP_LABEL:"Map",TABLE_LABEL:"Table",LAYERS:"Layers",FILTERS:"Filters",FILTER_INFO:'At the moment, no filters have been selected. In order to add a filter, click on an icon or area on the map, and click on the filter icon (<span class="fa fa-filter"></span>) in the right menu. This will create a filter for the selected property.',STYLES:"Styles",STYLE_INFO:'At the moment, no style has been selected. In order to add a style, click on an icon or area on the map, and click on the style icon (<span class="fa fa-eye"></span>) in the right menu. This will create a filter for the selected property.',FEATURES:"Features",LEGEND:"Legend",SEARCH:"Search",MAP_FEATURES:"Map features",WHITE_RED:"white - red",RED_WHITE:"red - white",GREEN_RED:"green - red",RED_GREEN:"red - green",WHITE_BLUE:"white - blue",BLUE_WHITE:"blue - white",WHITE_GREEN:"white - green",GREEN_WHITE:"green - white",WHITE_ORANGE:"white - orange",ORANGE_WHITE:"orange - white",MCA:{SHOW_FEATURE_MSG:"Select a feature on the map to see the effects of the Multi-Criteria Analysis (MCA).",TOTAL_RESULT:"Combined result",DELETE_MSG:'Delete "{0}"',DELETE_MSG2:"Are you sure?",HAS_CATEGORY:"  Has category? ",HAS_RANK:"  Include rank? ",EDITOR_TITLE:"MCA Editor",MAIN_FEATURE:"Select the main feature",PROPERTIES:"Select the properties",INCLUDE_RANK:"  Show rank? ",RANK_TITLE:"Rank title...",TITLE:"Title..."},SHOW5:"Show 5 items",SHOW10:"Show 10 items",SHOW15:"Show 15 items",SHOW20:"Show 20 items",SHOW25:"Show 25 items",SHOW30:"Show 30 items",SHOW35:"Show 35 items",SHOW40:"Show 40 items"},e}();e.English=t}(Translations||(Translations={}));var Translations;!function(e){var t=function(){function e(){}return e.locale={CANCEL_BTN:"Annuleren",OK_BTN:"OK",MAP:"Kaarten",MAP_LABEL:"Kaart",TABLE_LABEL:"Tabel",LAYERS:"Kaartlagen",FILTERS:"Filters",FILTER_INFO:'Momenteel zijn er geen filters geselecteerd. Klik op een icoon of gebied op de kaart, en klik op het filter icoontje (<span class="fa fa-filter"></span>) in het rechter menu om een filter toe te voegen. Dan wordt er een filter aangemaakt voor de geselecteerde eigenschap.',STYLES:"Stijlen",STYLE_INFO:'Momenteel zijn er geen stijlen geselecteerd. Klik op een icoon of gebied op de kaart, en klik op het stijl icoontje (<span class="fa fa-eye"></span>) in het rechter menu om een stijl toe te voegen. Dan wordt er een stijl aangemaakt voor de geselecteerde eigenschap.',FEATURES:"Features",LEGEND:"Legenda",SEARCH:"Zoeken",MAP_FEATURES:"Kaartfeatures",WHITE_RED:"wit - rood",RED_WHITE:"rood - wit",GREEN_RED:"groen - rood",RED_GREEN:"rood - groen",WHITE_BLUE:"wit - blauw",BLUE_WHITE:"wit - groen",WHITE_GREEN:"wit - groen",GREEN_WHITE:"groen - wit",WHITE_ORANGE:"wit - oranje",ORANGE_WHITE:"oranje - wit",MCA:{SHOW_FEATURE_MSG:"Selecteer een feature op de kaart om de Multi-Criteria Analyse (MCA) resultaten in detail te bekijken.",TOTAL_RESULT:"Gecombineerd resultaat",DELETE_MSG:'Verwijder "{0}"',DELETE_MSG2:"Weet u het zeker?",HAS_CATEGORY:"  Specificeer categorie? ",EDITOR_TITLE:"MCA Editor",MAIN_FEATURE:"Selecteer het type feature",PROPERTIES:"Selecteer de eigenschappen",INCLUDE_RANK:"  Toon een rangorde? ",RANK_TITLE:"Titel voor de rangorde...",TITLE:"Titel..."},SHOW5:"Toon 5 regels",SHOW10:"Toon 10 regels",SHOW15:"Toon 15 regels",SHOW20:"Toon 20 regels",SHOW25:"Toon 25 regels",SHOW30:"Toon 30 regels",SHOW35:"Toon 35 regels",SHOW40:"Toon 40 regels"},e}();e.Dutch=t}(Translations||(Translations={}));